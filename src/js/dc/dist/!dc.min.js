!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3"),require("d3"),require("d3"),require("d3"),require("d3"),require("d3"),require("d3"),require("d3"),require("d3"),require("d3"),require("d3"),require("d3"),require("d3"),require("d3"),require("d3"),require("d3"),require("d3"),require("d3"),require("d3")):"function"==typeof define&&define.amd?define(["exports","d3","d3","d3","d3","d3","d3","d3","d3","d3","d3","d3","d3","d3","d3","d3","d3","d3","d3","d3"],e):e((t=t||self).dc={},t.d3,t.d3,t.d3,t.d3,t.d3,t.d3,t.d3,t.d3,t.d3,t.d3,t.d3,t.d3,t.d3,t.d3,t.d3,t.d3,t.d3,t.d3,t.d3)}(this,function(t,e,s,i,T,r,E,z,h,a,n,l,o,c,d,_,u,g,p,y){"use strict";class m extends Error{}const x={CHART_CLASS:"dc-chart",DEBUG_GROUP_CLASS:"debug",STACK_CLASS:"stack",DESELECTED_CLASS:"deselected",SELECTED_CLASS:"selected",NODE_INDEX_NAME:"__index__",GROUP_INDEX_NAME:"__group_index__",DEFAULT_CHART_GROUP:"__default_chart_group__",EVENT_DELAY:40,NEGLIGIBLE_NUMBER:1e-10};class f{constructor(){this.enableDebugLog=!1,this._alreadyWarned={}}warn(t){return console&&(console.warn?console.warn(t):console.log&&console.log(t)),this}warnOnce(t){return this._alreadyWarned[t]||(this._alreadyWarned[t]=!0,b.warn(t)),this}debug(t){return this.enableDebugLog&&console&&(console.debug?console.debug(t):console.log&&console.log(t)),this}}const b=new f;class A{constructor(){this._defaultColors=A._schemeCategory20c,this.dateFormat=e.timeFormat("%m/%d/%Y"),this._renderlet=null,this.disableTransitions=!1}defaultColors(t){return arguments.length?(this._defaultColors=t,this):(this._defaultColors===A._schemeCategory20c&&b.warnOnce("You are using d3.schemeCategory20c, which has been removed in D3v5. See the explanation at https://github.com/d3/d3/blob/master/CHANGES.md#changes-in-d3-50. DC is using it for backward compatibility, however it will be changed in DCv3.1. You can change it by calling dc.config.defaultColors(newScheme). See https://github.com/d3/d3-scale-chromatic for some alternatives."),this._defaultColors)}}A._schemeCategory20c=["#3182bd","#6baed6","#9ecae1","#c6dbef","#e6550d","#fd8d3c","#fdae6b","#fdd0a2","#31a354","#74c476","#a1d99b","#c7e9c0","#756bb1","#9e9ac8","#bcbddc","#dadaeb","#636363","#969696","#bdbdbd","#d9d9d9"];const v=new A,C={eventHandler:i=>function(t,e){console.warn("No d3.js compatbility event handler registered, defaulting to v6 behavior."),i.call(this,e,t)},nester:({})=>{throw new Error("No d3.js compatbility nester registered, load v5 or v6 compability layer.")},pointer:()=>{throw new Error("No d3.js compatbility pointer registered, load v5 or v6 compability layer.")}};function k(t,e){w.register(t,e)}function S(t,e){w.deregister(t,e)}const w=new class{constructor(){this._chartMap={}}_initializeChartGroup(t){return t=t||x.DEFAULT_CHART_GROUP,this._chartMap[t]||(this._chartMap[t]=[]),t}has(t){for(const e in this._chartMap)if(0<=this._chartMap[e].indexOf(t))return!0;return!1}register(t,e){const i=this._chartMap;e=this._initializeChartGroup(e),i[e].push(t)}deregister(e,i){i=this._initializeChartGroup(i);for(let t=0;t<this._chartMap[i].length;t++)if(this._chartMap[i][t].anchorName()===e.anchorName()){this._chartMap[i].splice(t,1);break}}clear(t){t?delete this._chartMap[t]:this._chartMap={}}list(t){return t=this._initializeChartGroup(t),this._chartMap[t]}};function L(t){const e=w.list(t);for(let t=0;t<e.length;++t)e[t].render();null!==v._renderlet&&v._renderlet(t)}function R(t){const e=w.list(t);for(let t=0;t<e.length;++t)e[t].redraw();null!==v._renderlet&&v._renderlet(t)}function D(t,e,i,s){if(v.disableTransitions||e<=0)return t;let r=t.transition(s);return(0<=e||void 0!==e)&&(r=r.duration(e)),(0<=i||void 0!==i)&&(r=r.delay(i)),r}function O(t,e,i,s){return t?function(t){return D(t,e,i,s)}:function(t){return t}}function B(t){return t instanceof Object&&t.__dcFlag__&&!0}const $={current:null,trigger:function(t,e){e?($.current=t,setTimeout(()=>{t===$.current&&t()},e)):t()}},F={RangedFilter:function(t,e){const i=new Array(t,e);return i.isFiltered=function(t){return t>=this[0]&&t<this[1]},i.filterType="RangedFilter",i},TwoDimensionalFilter:function(t){if(null===t)return null;const e=t;return e.isFiltered=function(t){return t.length&&t.length===e.length&&t[0]===e[0]&&t[1]===e[1]},e.filterType="TwoDimensionalFilter",e},RangedTwoDimensionalFilter:function(t){if(null===t)return null;const e=t;let s;return s=e[0]instanceof Array?[[Math.min(t[0][0],t[1][0]),Math.min(t[0][1],t[1][1])],[Math.max(t[0][0],t[1][0]),Math.max(t[0][1],t[1][1])]]:[[t[0],-1/0],[t[1],1/0]],e.isFiltered=function(t){let e,i;return i=t instanceof Array?(e=t[0],t[1]):(e=t,s[0][1]),e>=s[0][0]&&e<s[1][0]&&i>=s[0][1]&&i<s[1][1]},e.filterType="RangedTwoDimensionalFilter",e},HierarchyFilter:function(t){if(null===t)return null;const i=t.slice(0);return i.isFiltered=function(e){if(!(i.length&&e&&e.length&&e.length>=i.length))return!1;for(let t=0;t<i.length;t++)if(e[t]!==i[t])return!1;return!0},i}};class P extends Error{}function H(i,s){return s?function(t,e){return s.call(t,t[i],e)}:function(t){return t[i]}}const M={printSingleValue:function(t){let e=`${t}`;return t instanceof Date?e=v.dateFormat(t):"string"==typeof t?e=t:M.isFloat(t)?e=M.printSingleValue.fformat(t):M.isInteger(t)&&(e=Math.round(t)),e}};M.printSingleValue.fformat=i.format(".2f"),M._toTimeFunc=function(t){return{second:s.timeSecond,minute:s.timeMinute,hour:s.timeHour,day:s.timeDay,week:s.timeWeek,month:s.timeMonth,year:s.timeYear}[t]},M.add=function(t,e,i){if("string"==typeof e&&(e=e.replace("%","")),t instanceof Date)return"string"==typeof e&&(e=+e),"millis"===i?new Date(t.getTime()+e):(i="function"!=typeof(i=i||s.timeDay)?M._toTimeFunc(i):i).offset(t,e);if("string"!=typeof e)return t+e;e=+e/100;return 0<t?t*(1+e):t*(1-e)},M.subtract=function(t,e,i){if("string"==typeof e&&(e=e.replace("%","")),t instanceof Date)return"string"==typeof e&&(e=+e),"millis"===i?new Date(t.getTime()-e):(i="function"!=typeof(i=i||s.timeDay)?M._toTimeFunc(i):i).offset(t,-e);if("string"!=typeof e)return t-e;e=+e/100;return t<0?t*(1+e):t*(1-e)},M.isNumber=function(t){return t===+t},M.isFloat=function(t){return t===+t&&t!==(0|t)},M.isInteger=function(t){return t===+t&&t===(0|t)},M.isNegligible=function(t){return!M.isNumber(t)||t<x.NEGLIGIBLE_NUMBER&&t>-x.NEGLIGIBLE_NUMBER},M.clamp=function(t,e,i){return t<e?e:i<t?i:t},M.constant=function(t){return function(){return t}};let N=0;M.uniqueId=function(){return++N},M.nameToId=function(t){return t.toLowerCase().replace(/[\s]/g,"_").replace(/[\.']/g,"")},M.appendOrSelect=function(t,e,i){i=i||e;let s=t.select(e);return s.empty()&&(s=t.append(i)),s},M.safeNumber=function(t){return M.isNumber(+t)?+t:0},M.arraysEqual=function(t,i){return!t&&!i||!(!t||!i)&&(t.length===i.length&&t.every((t,e)=>t.valueOf()===i[e].valueOf()))},M.allChildren=function(e){let i=[];if(i.push(e.path),console.log("currentNode",e),e.children)for(let t=0;t<e.children.length;t++)i=i.concat(M.allChildren(e.children[t]));return i},M.toHierarchy=function(e,s){var r={key:"root",children:[]};for(let t=0;t<e.length;t++){var a=e[t];const o=a.key;var h=s(a);let i=r;for(let e=0;e<o.length;e++){var n=o.slice(0,e+1);const c=i.children;var l=o[e];let t;e+1<o.length?(t=function(e,i){for(let t=0;t<e.length;t++)if(e[t].key===i)return e[t]}(c,l),void 0===t&&(t={key:l,children:[],path:n},c.push(t)),i=t):(t={key:l,value:h,data:a,path:n},c.push(t))}}return r},M.getAncestors=function(t){const e=[];let i=t;for(;i.parent;)e.unshift(i.name),i=i.parent;return e},M.arraysIdentical=function(t,e){let i=t.length;if(i!==e.length)return!1;for(;i--;)if(t[i]!==e[i])return!1;return!0};const G={filters:function(e){let i="";for(let t=0;t<e.length;++t)0<t&&(i+=", "),i+=G.filter(e[t]);return i},filter:function(t){let e="";return null!=t&&(t instanceof Array?2<=t.length?e=`[${t.map(t=>M.printSingleValue(t)).join(" -> ")}]`:1<=t.length&&(e=M.printSingleValue(t[0])):e=M.printSingleValue(t)),e}},Y={integers:function(t,e){return Math.abs(e-t)},ordinal:function(){throw new Error("dc.units.ordinal should not be called - it is a placeholder")},fp:{}};Y.fp.precision=function(t){function i(t,e){return t=Math.abs((e-t)/i.resolution),M.isNegligible(t-Math.floor(t))?Math.floor(t):Math.ceil(t)}return i.resolution=t,i};const V=(t,s)=>(0===s.length?t.filter(null):1!==s.length||s[0].isFiltered?1===s.length&&"RangedFilter"===s[0].filterType?t.filterRange(s[0]):t.filterFunction(e=>{for(let t=0;t<s.length;t++){const i=s[t];if(i.isFiltered){if(i.isFiltered(e))return!0}else if(i<=e&&i>=e)return!0}return!1}):t.filterExact(s[0]),s),I=(t,e)=>null==e?0<t.length:t.some(t=>e<=t&&t<=e),W=(e,i)=>{for(let t=0;t<e.length;t++)if(e[t]<=i&&e[t]>=i){e.splice(t,1);break}return e},U=(t,e)=>(t.push(e),t),X=t=>[];class q{constructor(){this.__dcFlag__=M.uniqueId(),this._svgDescription=null,this._keyboardAccessible=!1,this._dimension=void 0,this._group=void 0,this._anchor=void 0,this._root=void 0,this._svg=void 0,this._isChild=void 0,this._minWidth=200,this._defaultWidthCalc=t=>{t=t&&t.getBoundingClientRect&&t.getBoundingClientRect().width;return t&&t>this._minWidth?t:this._minWidth},this._widthCalc=this._defaultWidthCalc,this._minHeight=200,this._defaultHeightCalc=t=>{t=t&&t.getBoundingClientRect&&t.getBoundingClientRect().height;return t&&t>this._minHeight?t:this._minHeight},this._heightCalc=this._defaultHeightCalc,this._width=void 0,this._height=void 0,this._useViewBoxResizing=!1,this._keyAccessor=H("key"),this._valueAccessor=H("value"),this._label=H("key"),this._ordering=H("key"),this._renderLabel=!1,this._title=t=>`${this.keyAccessor()(t)}: ${this.valueAccessor()(t)}`,this._renderTitle=!0,this._controlsUseVisibility=!1,this._transitionDuration=750,this._transitionDelay=0,this._filterPrinter=G.filters,this._mandatoryAttributesList=["dimension","group"],this._chartGroup=x.DEFAULT_CHART_GROUP,this._listeners=r.dispatch("preRender","postRender","preRedraw","postRedraw","filtered","zoomed","renderlet","pretransition"),this._legend=void 0,this._commitHandler=void 0,this._defaultData=t=>t.all(),this._data=this._defaultData,this._filters=[],this._filterHandler=V,this._hasFilterHandler=I,this._removeFilterHandler=W,this._addFilterHandler=U,this._resetFilterHandler=X}height(t){return arguments.length?(this._heightCalc=t?"function"==typeof t?t:M.constant(t):this._defaultHeightCalc,this._height=void 0,this):(M.isNumber(this._height)||(this._height=this._heightCalc(this._root.node())),this._height)}width(t){return arguments.length?(this._widthCalc=t?"function"==typeof t?t:M.constant(t):this._defaultWidthCalc,this._width=void 0,this):(M.isNumber(this._width)||(this._width=this._widthCalc(this._root.node())),this._width)}minWidth(t){return arguments.length?(this._minWidth=t,this):this._minWidth}minHeight(t){return arguments.length?(this._minHeight=t,this):this._minHeight}useViewBoxResizing(t){return arguments.length?(this._useViewBoxResizing=t,this):this._useViewBoxResizing}dimension(t){return arguments.length?(this._dimension=t,this.expireCache(),this):this._dimension}data(t){return arguments.length?(this._data="function"==typeof t?t:M.constant(t),this.expireCache(),this):this._data(this._group)}group(t,e){return arguments.length?(this._group=t,this._groupName=e,this.expireCache(),this):this._group}ordering(t){return arguments.length?(this._ordering=t,this.expireCache(),this):this._ordering}_computeOrderedGroups(t){return Array.from(t).sort((t,e)=>E.ascending(this._ordering(t),this._ordering(e)))}filterAll(){return this.filter(null)}select(t){return this._root.select(t)}selectAll(t){return this._root?this._root.selectAll(t):null}anchor(t,e){if(!arguments.length)return this._anchor;if(B(t))this._anchor=t.anchor(),this._anchor.children&&(this._anchor=`#${t.anchorName()}`),this._root=t.root(),this._isChild=!0;else{if(!t)throw new m("parent must be defined");t.select&&t.classed?this._anchor=t.node():this._anchor=t,this._root=T.select(this._anchor),this._root.classed(x.CHART_CLASS,!0),k(this,e),this._isChild=!1}return this._chartGroup=e,this}anchorName(){const t=this.anchor();return t&&t.id?t.id:t&&t.replace?t.replace("#",""):`dc-chart${this.chartID()}`}root(t){return arguments.length?(this._root=t,this):this._root}svg(t){return arguments.length?(this._svg=t,this):this._svg}resetSvg(){return this.select("svg").remove(),this.generateSvg()}sizeSvg(){this._svg&&(this._useViewBoxResizing?this._svg.attr("viewBox")||this._svg.attr("viewBox",`0 0 ${this.width()} ${this.height()}`):this._svg.attr("width",this.width()).attr("height",this.height()))}generateSvg(){return this._svg=this.root().append("svg"),(this._svgDescription||this._keyboardAccessible)&&(this._svg.append("desc").attr("id",`desc-id-${this.__dcFlag__}`).html(`${this.svgDescription()}`),this._svg.attr("tabindex","0").attr("role","img").attr("aria-labelledby",`desc-id-${this.__dcFlag__}`)),this.sizeSvg(),this._svg}svgDescription(t){return arguments.length?(this._svgDescription=t,this):this._svgDescription||this.constructor.name}keyboardAccessible(t){return arguments.length?(this._keyboardAccessible=t,this):this._keyboardAccessible}filterPrinter(t){return arguments.length?(this._filterPrinter=t,this):this._filterPrinter}controlsUseVisibility(t){return arguments.length?(this._controlsUseVisibility=t,this):this._controlsUseVisibility}turnOnControls(){var t;return this._root&&(t=this.controlsUseVisibility()?"visibility":"display",this.selectAll(".reset").style(t,null),this.selectAll(".filter").text(this._filterPrinter(this.filters())).style(t,null)),this}turnOffControls(){var t,e;return this._root&&(t=this.controlsUseVisibility()?"visibility":"display",e=this.controlsUseVisibility()?"hidden":"none",this.selectAll(".reset").style(t,e),this.selectAll(".filter").style(t,e).text(this.filter())),this}transitionDuration(t){return arguments.length?(this._transitionDuration=t,this):this._transitionDuration}transitionDelay(t){return arguments.length?(this._transitionDelay=t,this):this._transitionDelay}_mandatoryAttributes(t){return arguments.length?(this._mandatoryAttributesList=t,this):this._mandatoryAttributesList}checkForMandatoryAttributes(t){if(!this[t]||!this[t]())throw new P(`Mandatory attribute chart.${t} is missing on chart[#${this.anchorName()}]`)}render(){this._height=this._width=void 0,this._listeners.call("preRender",this,this),this._mandatoryAttributesList&&this._mandatoryAttributesList.forEach(t=>this.checkForMandatoryAttributes(t));var t=this._doRender();return this._legend&&this._legend.render(),this._activateRenderlets("postRender"),t}_makeKeyboardAccessible(i,...s){const t=this._svg.selectAll(".dc-tabbable").attr("tabindex",0);i&&t.on("keydown",C.eventHandler((t,e)=>{13===e.keyCode&&"object"==typeof t&&i.call(this,t,...s),32===e.keyCode&&"object"==typeof t&&(i.call(this,t,...s),e.preventDefault())}))}_activateRenderlets(t){this._listeners.call("pretransition",this,this),0<this.transitionDuration()&&this._svg?this._svg.transition().duration(this.transitionDuration()).delay(this.transitionDelay()).on("end",()=>{this._listeners.call("renderlet",this,this),t&&this._listeners.call(t,this,this)}):(this._listeners.call("renderlet",this,this),t&&this._listeners.call(t,this,this))}redraw(){this.sizeSvg(),this._listeners.call("preRedraw",this,this);var t=this._doRedraw();return this._legend&&this._legend.render(),this._activateRenderlets("postRedraw"),t}commitHandler(t){return arguments.length?(this._commitHandler=t,this):this._commitHandler}redrawGroup(){return this._commitHandler?this._commitHandler(!1,(t,e)=>{t?console.log(t):R(this.chartGroup())}):R(this.chartGroup()),this}renderGroup(){return this._commitHandler?this._commitHandler(!1,(t,e)=>{t?console.log(t):L(this.chartGroup())}):L(this.chartGroup()),this}_invokeFilteredListener(t){void 0!==t&&this._listeners.call("filtered",this,this,t)}_invokeZoomedListener(){this._listeners.call("zoomed",this,this)}hasFilterHandler(t){return arguments.length?(this._hasFilterHandler=t,this):this._hasFilterHandler}hasFilter(t){return this._hasFilterHandler(this._filters,t)}removeFilterHandler(t){return arguments.length?(this._removeFilterHandler=t,this):this._removeFilterHandler}addFilterHandler(t){return arguments.length?(this._addFilterHandler=t,this):this._addFilterHandler}resetFilterHandler(t){return arguments.length?(this._resetFilterHandler=t,this):this._resetFilterHandler}applyFilters(t){var e;return this.dimension()&&this.dimension().filter&&((e=this._filterHandler(this.dimension(),t))&&(t=e)),t}replaceFilter(t){return this._filters=this._resetFilterHandler(this._filters),this.filter(t),this}filter(t){if(!arguments.length)return 0<this._filters.length?this._filters[0]:null;let e=this._filters;return t instanceof Array&&t[0]instanceof Array&&!t.isFiltered?t[0].forEach(t=>{e=this._hasFilterHandler(e,t)?this._removeFilterHandler(e,t):this._addFilterHandler(e,t)}):e=null===t?this._resetFilterHandler(e):this._hasFilterHandler(e,t)?this._removeFilterHandler(e,t):this._addFilterHandler(e,t),this._filters=this.applyFilters(e),this._invokeFilteredListener(t),null!==this._root&&this.hasFilter()?this.turnOnControls():this.turnOffControls(),this}filters(){return this._filters}highlightSelected(t){T.select(t).classed(x.SELECTED_CLASS,!0),T.select(t).classed(x.DESELECTED_CLASS,!1)}fadeDeselected(t){T.select(t).classed(x.SELECTED_CLASS,!1),T.select(t).classed(x.DESELECTED_CLASS,!0)}resetHighlight(t){T.select(t).classed(x.SELECTED_CLASS,!1),T.select(t).classed(x.DESELECTED_CLASS,!1)}onClick(t){const e=this.keyAccessor()(t);$.trigger(()=>{this.filter(e),this.redrawGroup()})}filterHandler(t){return arguments.length?(this._filterHandler=t,this):this._filterHandler}_doRender(){return this}_doRedraw(){return this}legendables(){return[]}legendHighlight(){}legendReset(){}legendToggle(){}isLegendableHidden(){return!1}keyAccessor(t){return arguments.length?(this._keyAccessor=t,this):this._keyAccessor}valueAccessor(t){return arguments.length?(this._valueAccessor=t,this):this._valueAccessor}label(t,e){return arguments.length?(this._label=t,void 0!==e&&!e||(this._renderLabel=!0),this):this._label}renderLabel(t){return arguments.length?(this._renderLabel=t,this):this._renderLabel}title(t){return arguments.length?(this._title=t,this):this._title}renderTitle(t){return arguments.length?(this._renderTitle=t,this):this._renderTitle}chartGroup(t){return arguments.length?(this._isChild||S(this,this._chartGroup),this._chartGroup=t,this._isChild||k(this,this._chartGroup),this):this._chartGroup}expireCache(){return this}legend(t){return arguments.length?(this._legend=t,this._legend.parent(this),this):this._legend}chartID(){return this.__dcFlag__}options(t){const e=["anchor","group","xAxisLabel","yAxisLabel","stack","title","point","getColor","overlayGeoJson"];for(const i in t)"function"==typeof this[i]?t[i]instanceof Array&&-1!==e.indexOf(i)?this[i].apply(this,t[i]):this[i].call(this,t[i]):b.debug(`Not a valid option setter name: ${i}`);return this}on(t,e){return this._listeners.on(t,e),this}renderlet(t){return b.warnOnce('chart.renderlet has been deprecated. Please use chart.on("renderlet.<renderletKey>", renderletFunction)'),this.on(`renderlet.${M.uniqueId()}`,t),this}}const j=t=>class extends t{constructor(){super(),this._colors=z.scaleOrdinal(v.defaultColors()),this._colorAccessor=t=>this.keyAccessor()(t),this._colorCalculator=void 0;{const i=this;i.getColor=function(t,e){return i._colorCalculator?i._colorCalculator.call(this,t,e):i._colors(i._colorAccessor.call(this,t,e))}}}calculateColorDomain(){var t=[E.min(this.data(),this.colorAccessor()),E.max(this.data(),this.colorAccessor())];return this._colors.domain(t),this}colors(t){return arguments.length?(t instanceof Array?this._colors=z.scaleQuantize().range(t):this._colors="function"==typeof t?t:M.constant(t),this):this._colors}ordinalColors(t){return this.colors(z.scaleOrdinal().range(t))}linearColors(t){return this.colors(z.scaleLinear().range(t).interpolate(h.interpolateHcl))}colorAccessor(t){return arguments.length?(this._colorAccessor=t,this):this._colorAccessor}colorDomain(t){return arguments.length?(this._colors.domain(t),this):this._colors.domain()}colorCalculator(t){return arguments.length?(this._colorCalculator=t,this):this._colorCalculator||this.getColor}};var K=t=>class extends j(t){constructor(){super(),this._maxBubbleRelativeSize=.3,this._minRadiusWithLabel=10,this._sortBubbleSize=!1,this._elasticRadius=!1,this._excludeElasticZero=!0,this.BUBBLE_NODE_CLASS="node",this.BUBBLE_CLASS="bubble",this.MIN_RADIUS=10,this.renderLabel(!0),this.data(t=>{const e=t.all();if(this._keyboardAccessible&&e.sort((t,e)=>E.ascending(this.keyAccessor()(t),this.keyAccessor()(e))),this._sortBubbleSize){const i=this.radiusValueAccessor();e.sort((t,e)=>E.descending(i(t),i(e)))}return e}),this._r=z.scaleLinear().domain([0,100])}_rValueAccessor(t){return t.r}r(t){return arguments.length?(this._r=t,this):this._r}elasticRadius(t){return arguments.length?(this._elasticRadius=t,this):this._elasticRadius}calculateRadiusDomain(){this._elasticRadius&&this.r().domain([this.rMin(),this.rMax()])}radiusValueAccessor(t){return arguments.length?(this._rValueAccessor=t,this):this._rValueAccessor}rMin(){let t=this.data().map(this.radiusValueAccessor());return this._excludeElasticZero&&(t=t.filter(t=>0<t)),E.min(t)}rMax(){return E.max(this.data(),t=>this.radiusValueAccessor()(t))}bubbleR(t){t=this.radiusValueAccessor()(t);let e=this.r()(t);return(isNaN(e)||t<=0)&&(e=0),e}_labelFunction(t){return this.label()(t)}_shouldLabel(t){return this.bubbleR(t)>this._minRadiusWithLabel}_labelOpacity(t){return this._shouldLabel(t)?1:0}_labelPointerEvent(t){return this._shouldLabel(t)?"all":"none"}_doRenderLabel(e){if(this.renderLabel()){let t=e.select("text");t.empty()&&(t=e.append("text").attr("text-anchor","middle").attr("dy",".3em").on("click",C.eventHandler(t=>this.onClick(t)))),t.attr("opacity",0).attr("pointer-events",t=>this._labelPointerEvent(t)).text(t=>this._labelFunction(t)),D(t,this.transitionDuration(),this.transitionDelay()).attr("opacity",t=>this._labelOpacity(t))}}doUpdateLabels(t){this.renderLabel()&&(t=t.select("text").attr("pointer-events",t=>this._labelPointerEvent(t)).text(t=>this._labelFunction(t)),D(t,this.transitionDuration(),this.transitionDelay()).attr("opacity",t=>this._labelOpacity(t)))}_titleFunction(t){return this.title()(t)}_doRenderTitles(t){if(this.renderTitle()){const e=t.select("title");e.empty()&&t.append("title").text(t=>this._titleFunction(t))}}doUpdateTitles(t){this.renderTitle()&&t.select("title").text(t=>this._titleFunction(t))}sortBubbleSize(t){return arguments.length?(this._sortBubbleSize=t,this):this._sortBubbleSize}minRadius(t){return arguments.length?(this.MIN_RADIUS=t,this):this.MIN_RADIUS}minRadiusWithLabel(t){return arguments.length?(this._minRadiusWithLabel=t,this):this._minRadiusWithLabel}maxBubbleRelativeSize(t){return arguments.length?(this._maxBubbleRelativeSize=t,this):this._maxBubbleRelativeSize}excludeElasticZero(t){return arguments.length?(this._excludeElasticZero=t,this):this._excludeElasticZero}fadeDeselectedArea(t){if(this.hasFilter()){const e=this;this.selectAll(`g.${e.BUBBLE_NODE_CLASS}`).each(function(t){e.isSelectedNode(t)?e.highlightSelected(this):e.fadeDeselected(this)})}else{const i=this;this.selectAll(`g.${i.BUBBLE_NODE_CLASS}`).each(function(){i.resetHighlight(this)})}}isSelectedNode(t){return this.hasFilter(t.key)}onClick(t){const e=t.key;$.trigger(()=>{this.filter(e),this.redrawGroup()})}},Z=t=>class extends t{constructor(){super(),this._cap=1/0,this._takeFront=!0,this._othersLabel="Others",this._othersGrouper=(t,e)=>{var i=E.sum(e,this.valueAccessor()),e=e.map(this.keyAccessor());return 0<i?t.concat([{others:e,key:this.othersLabel(),value:i}]):t},this.ordering(t=>-t.value),this.data(i=>{if(this._cap===1/0)return this._computeOrderedGroups(i.all());{let t=i.all(),e;return t=this._computeOrderedGroups(t),this._cap&&(t=this._takeFront?(e=t.slice(this._cap),t.slice(0,this._cap)):(i=Math.max(0,t.length-this._cap),e=t.slice(0,i),t.slice(i))),this._othersGrouper?this._othersGrouper(t,e):t}})}cappedKeyAccessor(t,e){return t.others?t.key:this.keyAccessor()(t,e)}cappedValueAccessor(t,e){return t.others?t.value:this.valueAccessor()(t,e)}cap(t){return arguments.length?(this._cap=t,this):this._cap}takeFront(t){return arguments.length?(this._takeFront=t,this):this._takeFront}othersLabel(t){return arguments.length?(this._othersLabel=t,this):this._othersLabel}othersGrouper(t){return arguments.length?(this._othersGrouper=t,this):this._othersGrouper}onClick(t){t.others&&this.filter([t.others]),super.onClick(t)}};class J extends q{constructor(){super(),this._margin={top:10,right:50,bottom:30,left:30}}margins(t){return arguments.length?(this._margin=t,this):this._margin}effectiveWidth(){return this.width()-this.margins().left-this.margins().right}effectiveHeight(){return this.height()-this.margins().top-this.margins().bottom}}const Q="grid-line",tt="horizontal",et="vertical",it="y-axis-label",st="x-axis-label",rt="custom-brush-handle";class at extends j(J){constructor(){super(),this.colors(z.scaleOrdinal(a.schemeCategory10)),this._mandatoryAttributes().push("x"),this._parent=void 0,this._g=void 0,this._chartBodyG=void 0,this._x=void 0,this._origX=void 0,this._xOriginalDomain=void 0,this._xAxis=null,this._xUnits=Y.integers,this._xAxisPadding=0,this._xAxisPaddingUnit=s.timeDay,this._xElasticity=!1,this._xAxisLabel=void 0,this._xAxisLabelPadding=0,this._lastXDomain=void 0,this._y=void 0,this._yAxis=null,this._yAxisPadding=0,this._yElasticity=!1,this._yAxisLabel=void 0,this._yAxisLabelPadding=0,this._brush=o.brushX(),this._gBrush=void 0,this._brushOn=!0,this._parentBrushOn=!1,this._round=void 0,this._ignoreBrushEvents=!1,this._renderHorizontalGridLine=!1,this._renderVerticalGridLine=!1,this._resizing=!1,this._unitCount=void 0,this._zoomScale=[1,1/0],this._zoomOutRestrict=!0,this._zoom=l.zoom().on("zoom",C.eventHandler((t,e)=>this._onZoom(e))),this._nullZoom=l.zoom().on("zoom",null),this._hasBeenMouseZoomable=!1,this._ignoreZoomEvents=!1,this._rangeChart=void 0,this._focusChart=void 0,this._mouseZoomable=!1,this._clipPadding=0,this._fOuterRangeBandPadding=.5,this._fRangeBandPadding=0,this._useRightYAxis=!1,this._useTopXAxis=!1}rescale(){return this._unitCount=void 0,this._resizing=!0,this}resizing(t){return arguments.length?(this._resizing=t,this):this._resizing}rangeChart(t){return arguments.length?(this._rangeChart=t,this._rangeChart.focusChart(this),this):this._rangeChart}zoomScale(t){return arguments.length?(this._zoomScale=t,this):this._zoomScale}zoomOutRestrict(t){return arguments.length?(this._zoomOutRestrict=t,this):this._zoomOutRestrict}_generateG(t){this._parent=void 0===t?this.svg():t;t=window.location.href.split("#")[0];return this._g=this._parent.append("g"),this._chartBodyG=this._g.append("g").attr("class","chart-body").attr("transform",`translate(${this.margins().left}, ${this.margins().top})`).attr("clip-path",`url(${t}#${this._getClipPathId()})`),this._g}g(t){return arguments.length?(this._g=t,this):this._g}mouseZoomable(t){return arguments.length?(this._mouseZoomable=t,this):this._mouseZoomable}chartBodyG(t){return arguments.length?(this._chartBodyG=t,this):this._chartBodyG}x(t){return arguments.length?(this._x=t,this._xOriginalDomain=this._x.domain(),this.rescale(),this):this._x}xOriginalDomain(){return this._xOriginalDomain}xUnits(t){return arguments.length?(this._xUnits=t,this):this._xUnits}xAxis(t){return arguments.length?(this._xAxis=t,this):(this._xAxis||(this._xAxis=this._createXAxis()),this._xAxis)}elasticX(t){return arguments.length?(this._xElasticity=t,this):this._xElasticity}xAxisPadding(t){return arguments.length?(this._xAxisPadding=t,this):this._xAxisPadding}xAxisPaddingUnit(t){return arguments.length?(this._xAxisPaddingUnit=t,this):this._xAxisPaddingUnit}xUnitCount(){return void 0===this._unitCount&&(this.isOrdinal()?this._unitCount=this.x().domain().length:(this._unitCount=this.xUnits()(this.x().domain()[0],this.x().domain()[1]),this._unitCount instanceof Array&&(this._unitCount=this._unitCount.length))),this._unitCount}useRightYAxis(t){return arguments.length?(this._useRightYAxis!==t&&this._yAxis&&b.warn("Value of useRightYAxis has been altered, after yAxis was created. You might get unexpected yAxis behavior. Make calls to useRightYAxis sooner in your chart creation process."),this._useRightYAxis=t,this):this._useRightYAxis}useTopXAxis(t){return arguments.length?(this._useTopXAxis!==t&&this._xAxis&&b.warn("Value of useTopXAxis has been altered, after xAxis was created. You might get unexpected yAxis behavior. Make calls to useTopXAxis sooner in your chart creation process."),this._useTopXAxis=t,this):this._useTopXAxis}isOrdinal(){return this.xUnits()===Y.ordinal}_useOuterPadding(){return!0}_ordinalXDomain(){const t=this._computeOrderedGroups(this.data());return t.map(this.keyAccessor())}_createXAxis(){return this._useTopXAxis?n.axisTop():n.axisBottom()}_prepareXAxis(t,e){this.isOrdinal()?(this._x.bandwidth||(b.warn("For compatibility with d3v4+, dc.js d3.0 ordinal bar/line/bubble charts need d3.scaleBand() for the x scale, instead of d3.scaleOrdinal(). Replacing .x() with a d3.scaleBand with the same domain - make the same change in your code to avoid this warning!"),this._x=z.scaleBand().domain(this._x.domain())),!this.elasticX()&&0!==this._x.domain().length||this._x.domain(this._ordinalXDomain())):this.elasticX()&&this._x.domain([this.xAxisMin(),this.xAxisMax()]);var i=this._x.domain();!e&&M.arraysEqual(this._lastXDomain,i)||this.rescale(),this._lastXDomain=i,this.isOrdinal()?this._x.range([0,this.xAxisLength()]).paddingInner(this._fRangeBandPadding).paddingOuter(this._useOuterPadding()?this._fOuterRangeBandPadding:0):this._x.range([0,this.xAxisLength()]),this._xAxis||(this._xAxis=this._createXAxis()),this._xAxis=this._xAxis.scale(this.x()),this._renderVerticalGridLines(t)}renderXAxis(t){let e=t.select("g.x");e.empty()&&(e=t.append("g").attr("class","axis x").attr("transform",`translate(${this.margins().left},${this._xAxisY()})`));let i=t.select(`text.${st}`);var s=this._useTopXAxis?this._xAxisLabelPadding:this.height()-this._xAxisLabelPadding;i.empty()&&this.xAxisLabel()&&(i=t.append("text").attr("class",st).attr("transform",`translate(${this.margins().left+this.xAxisLength()/2},${s})`).attr("text-anchor","middle")),this.xAxisLabel()&&i.text()!==this.xAxisLabel()&&i.text(this.xAxisLabel()),D(e,this.transitionDuration(),this.transitionDelay()).attr("transform",`translate(${this.margins().left},${this._xAxisY()})`).call(this._xAxis),D(i,this.transitionDuration(),this.transitionDelay()).attr("transform",`translate(${this.margins().left+this.xAxisLength()/2},${s})`)}_renderVerticalGridLines(t){let e=t.select(`g.${et}`);if(this._renderVerticalGridLine){e.empty()&&(e=t.insert("g",":first-child").attr("class",`${Q} ${et}`).attr("transform",`translate(${this.margins().left},${this.margins().top})`));t=this._xAxis.tickValues()?this._xAxis.tickValues():"function"==typeof this._x.ticks?this._x.ticks.apply(this._x,this._xAxis.tickArguments()):this._x.domain();const i=e.selectAll("line").data(t);t=i.enter().append("line").attr("x1",t=>this._x(t)).attr("y1",this._xAxisY()-this.margins().top).attr("x2",t=>this._x(t)).attr("y2",0).attr("opacity",0);D(t,this.transitionDuration(),this.transitionDelay()).attr("opacity",.5),D(i,this.transitionDuration(),this.transitionDelay()).attr("x1",t=>this._x(t)).attr("y1",this._xAxisY()-this.margins().top).attr("x2",t=>this._x(t)).attr("y2",0),i.exit().remove()}else e.selectAll("line").remove()}_xAxisY(){return this._useTopXAxis?this.margins().top:this.height()-this.margins().bottom}xAxisLength(){return this.effectiveWidth()}xAxisLabel(t,e){return arguments.length?(this._xAxisLabel=t,this.margins().bottom-=this._xAxisLabelPadding,this._xAxisLabelPadding=void 0===e?12:e,this.margins().bottom+=this._xAxisLabelPadding,this):this._xAxisLabel}_createYAxis(){return this._useRightYAxis?n.axisRight():n.axisLeft()}_prepareYAxis(t){var e,i;void 0!==this._y&&!this.elasticY()||(void 0===this._y&&(this._y=z.scaleLinear()),e=this.yAxisMin()||0,i=this.yAxisMax()||0,this._y.domain([e,i]).rangeRound([this.yAxisHeight(),0])),this._y.range([this.yAxisHeight(),0]),this._yAxis||(this._yAxis=this._createYAxis()),this._yAxis.scale(this._y),this._renderHorizontalGridLinesForAxis(t,this._y,this._yAxis)}renderYAxisLabel(t,e,i,s){s=s||this._yAxisLabelPadding;let r=this.g().select(`text.${it}.${t}-label`);var a=this.margins().top+this.yAxisHeight()/2;r.empty()&&e&&(r=this.g().append("text").attr("transform",`translate(${s},${a}),rotate(${i})`).attr("class",`${it} ${t}-label`).attr("text-anchor","middle").text(e)),e&&r.text()!==e&&r.text(e),D(r,this.transitionDuration(),this.transitionDelay()).attr("transform",`translate(${s},${a}),rotate(${i})`)}renderYAxisAt(t,e,i){let s=this.g().select(`g.${t}`);s.empty()&&(s=this.g().append("g").attr("class",`axis ${t}`).attr("transform",`translate(${i},${this.margins().top})`)),D(s,this.transitionDuration(),this.transitionDelay()).attr("transform",`translate(${i},${this.margins().top})`).call(e)}renderYAxis(){var t=this._useRightYAxis?this.width()-this.margins().right:this._yAxisX();this.renderYAxisAt("y",this._yAxis,t);var e=this._useRightYAxis?this.width()-this._yAxisLabelPadding:this._yAxisLabelPadding,t=this._useRightYAxis?90:-90;this.renderYAxisLabel("y",this.yAxisLabel(),t,e)}_renderHorizontalGridLinesForAxis(t,e,i){let s=t.select(`g.${tt}`);if(this._renderHorizontalGridLine){i=i.tickValues()?i.tickValues():e.ticks?e.ticks.apply(e,i.tickArguments()):e.domain();s.empty()&&(s=t.insert("g",":first-child").attr("class",`${Q} ${tt}`).attr("transform",`translate(${this.margins().left},${this.margins().top})`));const r=s.selectAll("line").data(i);i=r.enter().append("line").attr("x1",1).attr("y1",t=>e(t)).attr("x2",this.xAxisLength()).attr("y2",t=>e(t)).attr("opacity",0);D(i,this.transitionDuration(),this.transitionDelay()).attr("opacity",.5),D(r,this.transitionDuration(),this.transitionDelay()).attr("x1",1).attr("y1",t=>e(t)).attr("x2",this.xAxisLength()).attr("y2",t=>e(t)),r.exit().remove()}else s.selectAll("line").remove()}_yAxisX(){return this.useRightYAxis()?this.width()-this.margins().right:this.margins().left}yAxisLabel(t,e){return arguments.length?(this._yAxisLabel=t,this.margins().left-=this._yAxisLabelPadding,this._yAxisLabelPadding=void 0===e?12:e,this.margins().left+=this._yAxisLabelPadding,this):this._yAxisLabel}y(t){return arguments.length?(this._y=t,this.rescale(),this):this._y}yAxis(t){return arguments.length?(this._yAxis=t,this):(this._yAxis||(this._yAxis=this._createYAxis()),this._yAxis)}elasticY(t){return arguments.length?(this._yElasticity=t,this):this._yElasticity}renderHorizontalGridLines(t){return arguments.length?(this._renderHorizontalGridLine=t,this):this._renderHorizontalGridLine}renderVerticalGridLines(t){return arguments.length?(this._renderVerticalGridLine=t,this):this._renderVerticalGridLine}xAxisMin(){var t=E.min(this.data(),t=>this.keyAccessor()(t));return M.subtract(t,this._xAxisPadding,this._xAxisPaddingUnit)}xAxisMax(){var t=E.max(this.data(),t=>this.keyAccessor()(t));return M.add(t,this._xAxisPadding,this._xAxisPaddingUnit)}yAxisMin(){var t=E.min(this.data(),t=>this.valueAccessor()(t));return M.subtract(t,this._yAxisPadding)}yAxisMax(){var t=E.max(this.data(),t=>this.valueAccessor()(t));return M.add(t,this._yAxisPadding)}yAxisPadding(t){return arguments.length?(this._yAxisPadding=t,this):this._yAxisPadding}yAxisHeight(){return this.effectiveHeight()}round(t){return arguments.length?(this._round=t,this):this._round}_rangeBandPadding(t){return arguments.length?(this._fRangeBandPadding=t,this):this._fRangeBandPadding}_outerRangeBandPadding(t){return arguments.length?(this._fOuterRangeBandPadding=t,this):this._fOuterRangeBandPadding}filter(t){return arguments.length?(super.filter(t),this.redrawBrush(t,!1),this):super.filter()}brush(t){return arguments.length?(this._brush=t,this):this._brush}renderBrush(t,e){this._brushOn&&(this._brush.on("start brush end",C.eventHandler((t,e)=>this._brushing(e))),this._gBrush=t.append("g").attr("class","brush").attr("transform",`translate(${this.margins().left},${this.margins().top})`),this.setBrushExtents(),this.createBrushHandlePaths(this._gBrush,e),this.redrawBrush(this.filter(),e))}createBrushHandlePaths(t){let e=t.selectAll(`path.${rt}`).data([{type:"w"},{type:"e"}]);e=e.enter().append("path").attr("class",rt).merge(e),e.attr("d",t=>this.resizeHandlePath(t))}extendBrush(t){return t&&this.round()&&(t[0]=this.round()(t[0]),t[1]=this.round()(t[1])),t}brushIsEmpty(t){return!t||t[1]<=t[0]}_brushing(e){if(!this._ignoreBrushEvents){let t=e.selection;t=t&&t.map(this.x().invert),t=this.extendBrush(t),this.redrawBrush(t,!1);const i=this.brushIsEmpty(t)?null:F.RangedFilter(t[0],t[1]);$.trigger(()=>{this.applyBrushSelection(i)},x.EVENT_DELAY)}}applyBrushSelection(t){this.replaceFilter(t),this.redrawGroup()}_withoutBrushEvents(t){var e=this._ignoreBrushEvents;this._ignoreBrushEvents=!0;try{t()}finally{this._ignoreBrushEvents=e}}setBrushExtents(t){this._withoutBrushEvents(()=>{this._brush.extent([[0,0],[this.effectiveWidth(),this.effectiveHeight()]])}),this._gBrush.call(this._brush)}redrawBrush(i,t){if(!i){if(this._brushOn&&this._gBrush)if(this._resizing&&this.setBrushExtents(t),i){const e=[this._x(i[0]),this._x(i[1])],s=O(t,this.transitionDuration(),this.transitionDelay())(this._gBrush);this._withoutBrushEvents(()=>{s.call(this._brush.move,e)}),s.selectAll(`path.${rt}`).attr("display",null).attr("transform",(t,e)=>`translate(${this._x(i[e])}, 0)`).attr("d",t=>this.resizeHandlePath(t))}else this._withoutBrushEvents(()=>{this._gBrush.call(this._brush.move,null)}),this._gBrush.selectAll(`path.${rt}`).attr("display","none");this.fadeDeselectedArea(i)}}fadeDeselectedArea(t){}resizeHandlePath(t){var e=+("e"===(t=t.type)),i=e?1:-1,t=this.effectiveHeight()/3;return`M${.5*i},${t}A6,6 0 0 ${e} ${6.5*i},${6+t}V${2*t-6}A6,6 0 0 ${e} ${.5*i},${2*t}Z`+`M${2.5*i},${8+t}V${2*t-8}M${4.5*i},${8+t}V${2*t-8}`}_getClipPathId(){return`${this.anchorName().replace(/[ .#=\[\]"]/g,"-")}-clip`}clipPadding(t){return arguments.length?(this._clipPadding=t,this):this._clipPadding}_generateClipPath(){var t=M.appendOrSelect(this._parent,"defs"),e=this._getClipPathId(),t=M.appendOrSelect(t,`#${e}`,"clipPath").attr("id",e),e=2*this._clipPadding;M.appendOrSelect(t,"rect").attr("width",this.xAxisLength()+e).attr("height",this.yAxisHeight()+e).attr("transform",`translate(-${this._clipPadding}, -${this._clipPadding})`)}_preprocessData(){}_doRender(){return this.resetSvg(),this._preprocessData(),this._generateG(),this._generateClipPath(),this._drawChart(!0),this._configureMouseZoom(),this}_doRedraw(){return this._preprocessData(),this._drawChart(!1),this._generateClipPath(),this}_drawChart(t){this.isOrdinal()&&(this._brushOn=!1),this._prepareXAxis(this.g(),t),this._prepareYAxis(this.g()),this.plotData(),(this.elasticX()||this._resizing||t)&&this.renderXAxis(this.g()),(this.elasticY()||this._resizing||t)&&this.renderYAxis(this.g()),t?this.renderBrush(this.g(),!1):this.redrawBrush(this.filter(),this._resizing),this.fadeDeselectedArea(this.filter()),this.resizing(!1)}_configureMouseZoom(){this._origX=this._x.copy(),this._mouseZoomable?this._enableMouseZoom():this._hasBeenMouseZoomable&&this._disableMouseZoom()}_enableMouseZoom(){this._hasBeenMouseZoomable=!0;var t,e=[[0,0],[this.effectiveWidth(),this.effectiveHeight()]];this._zoom.scaleExtent(this._zoomScale).extent(e).duration(this.transitionDuration()),this._zoomOutRestrict&&(t=Math.max(this._zoomScale[0],1),this._zoom.translateExtent(e).scaleExtent([t,this._zoomScale[1]])),this.root().call(this._zoom),this._updateD3zoomTransform()}_disableMouseZoom(){this.root().call(this._nullZoom)}_zoomHandler(t,e){let i;i=this._hasRangeSelected(t)?(this.x().domain(t),F.RangedFilter(t[0],t[1])):(this.x().domain(this._xOriginalDomain),null),this.replaceFilter(i),this.rescale(),this.redraw(),e||(this._rangeChart&&!M.arraysEqual(this.filter(),this._rangeChart.filter())&&$.trigger(()=>{this._rangeChart.replaceFilter(i),this._rangeChart.redraw()}),this._invokeZoomedListener(),$.trigger(()=>{this.redrawGroup()},x.EVENT_DELAY))}_domainToZoomTransform(t,e,i){e=(e[1]-e[0])/(t[1]-t[0]),t=-1*i(t[0]);return l.zoomIdentity.scale(e).translate(t,0)}_updateD3zoomTransform(){this._zoom&&this._withoutZoomEvents(()=>{this._zoom.transform(this.root(),this._domainToZoomTransform(this.x().domain(),this._xOriginalDomain,this._origX))})}_withoutZoomEvents(t){var e=this._ignoreZoomEvents;this._ignoreZoomEvents=!0;try{t()}finally{this._ignoreZoomEvents=e}}_onZoom(t){this._ignoreZoomEvents||(t=t.transform.rescaleX(this._origX).domain(),this.focus(t,!1))}_checkExtents(t,e){return t&&2===t.length&&e&&2===e.length?((t[0]>e[1]||t[1]<e[0])&&console.warn("Could not intersect extents, will reset"),[(t[0]>e[0]?t:e)[0],(t[1]<e[1]?t:e)[1]]):t}focus(t,e){this._zoomOutRestrict&&(t=this._checkExtents(t,this._xOriginalDomain),this._rangeChart&&(t=this._checkExtents(t,this._rangeChart.x().domain()))),this._zoomHandler(t,e),this._updateD3zoomTransform()}refocused(){return!M.arraysEqual(this.x().domain(),this._xOriginalDomain)}focusChart(t){return arguments.length?(this._focusChart=t,this.on("filtered.dcjs-range-chart",t=>{t.filter()?M.arraysEqual(t.filter(),this._focusChart.filter())||$.trigger(()=>{this._focusChart.focus(t.filter(),!0)}):$.trigger(()=>{this._focusChart.x().domain(this._focusChart.xOriginalDomain(),!0)})}),this):this._focusChart}brushOn(t){return arguments.length?(this._brushOn=t,this):this._brushOn}parentBrushOn(t){return arguments.length?(this._parentBrushOn=t,this):this._parentBrushOn}gBrush(){return this._gBrush}_hasRangeSelected(t){return t instanceof Array&&1<t.length}}function ht(){let v=1,C=1,k=0,S=null,w=Number,L=nt,R=lt,D=null,O=!1,B=.3,$=.8,F=!1,P=!0,H=!1;function e(t){t.each(function(e,t){e=e.map(w).sort(E.ascending);const i=T.select(this);var s=e.length;let r,a;if(0!==s){var h=e.quartiles=R(e);const c=L&&L.call(this,e,t),d=c&&c.map(t=>e[t]);var n=c?E.range(0,c[0]).concat(E.range(c[1]+1,s)):E.range(s);a=P?(r=e[0],e[s-1]):(r=e[c[0]],e[c[1]]);var l=E.range(c[0],c[1]+1);const _=z.scaleLinear().domain(S&&S.call(this,e,t)||[r,a]).range([C,0]),u=this.__chart__||z.scaleLinear().domain([0,1/0]).range(_.range());this.__chart__=_;const g=i.selectAll("line.center").data(d?[d]:[]);g.enter().insert("line","rect").attr("class","center").attr("x1",v/2).attr("y1",t=>u(t[0])).attr("x2",v/2).attr("y2",t=>u(t[1])).style("opacity",1e-6).transition().duration(k).delay(0).style("opacity",1).attr("y1",t=>_(t[0])).attr("y2",t=>_(t[1])),g.transition().duration(k).delay(0).style("opacity",1).attr("x1",v/2).attr("x2",v/2).attr("y1",t=>_(t[0])).attr("y2",t=>_(t[1])),g.exit().transition().duration(k).delay(0).style("opacity",1e-6).attr("y1",t=>_(t[0])).attr("y2",t=>_(t[1])).remove();const p=i.selectAll("rect.box").data([h]);p.enter().append("rect").attr("class","box").attr("x",0).attr("y",t=>u(t[2])).attr("width",v).attr("height",t=>u(t[0])-u(t[2])).style("fill-opacity",O?.1:1).transition().duration(k).delay(0).attr("y",t=>_(t[2])).attr("height",t=>_(t[0])-_(t[2])),p.transition().duration(k).delay(0).attr("width",v).attr("y",t=>_(t[2])).attr("height",t=>_(t[0])-_(t[2]));const y=i.selectAll("line.median").data([h[1]]);y.enter().append("line").attr("class","median").attr("x1",0).attr("y1",u).attr("x2",v).attr("y2",u).transition().duration(k).delay(0).attr("y1",_).attr("y2",_),y.transition().duration(k).delay(0).attr("x1",0).attr("x2",v).attr("y1",_).attr("y2",_);const m=i.selectAll("line.whisker").data(d||[]);if(m.enter().insert("line","circle, text").attr("class","whisker").attr("x1",0).attr("y1",u).attr("x2",v).attr("y2",u).style("opacity",1e-6).transition().duration(k).delay(0).attr("y1",_).attr("y2",_).style("opacity",1),m.transition().duration(k).delay(0).attr("x1",0).attr("x2",v).attr("y1",_).attr("y2",_).style("opacity",1),m.exit().transition().duration(k).delay(0).attr("y1",_).attr("y2",_).style("opacity",1e-6).remove(),P){var o=H?"outlierBold":"outlier",s=H?3:5,t=H?function(){return Math.floor(Math.random()*(v*$)+1+(v-v*$)/2)}:function(){return v/2};const b=i.selectAll(`circle.${o}`).data(n,Number);b.enter().insert("circle","text").attr("class",o).attr("r",s).attr("cx",t).attr("cy",t=>u(e[t])).style("opacity",1e-6).transition().duration(k).delay(0).attr("cy",t=>_(e[t])).style("opacity",.6),F&&(b.selectAll("title").remove(),b.append("title").text(t=>e[t])),b.transition().duration(k).delay(0).attr("cx",t).attr("cy",t=>_(e[t])).style("opacity",.6),b.exit().transition().duration(k).delay(0).attr("cy",0).style("opacity",1e-6).remove()}if(O){const A=i.selectAll("circle.data").data(l);A.enter().insert("circle","text").attr("class","data").attr("r",3).attr("cx",()=>Math.floor(Math.random()*(v*$)+1+(v-v*$)/2)).attr("cy",t=>u(e[t])).style("opacity",1e-6).transition().duration(k).delay(0).attr("cy",t=>_(e[t])).style("opacity",B),F&&(A.selectAll("title").remove(),A.append("title").text(t=>e[t])),A.transition().duration(k).delay(0).attr("cx",()=>Math.floor(Math.random()*(v*$)+1+(v-v*$)/2)).attr("cy",t=>_(e[t])).style("opacity",B),A.exit().transition().duration(k).delay(0).attr("cy",0).style("opacity",1e-6).remove()}l=D||_.tickFormat(8);const x=i.selectAll("text.box").data(h);x.enter().append("text").attr("class","box").attr("dy",".3em").attr("dx",(t,e)=>1&e?6:-6).attr("x",(t,e)=>1&e?v:0).attr("y",u).attr("text-anchor",(t,e)=>1&e?"start":"end").text(l).transition().duration(k).delay(0).attr("y",_),x.transition().duration(k).delay(0).text(l).attr("x",(t,e)=>1&e?v:0).attr("y",_);const f=i.selectAll("text.whisker").data(d||[]);f.enter().append("text").attr("class","whisker").attr("dy",".3em").attr("dx",6).attr("x",v).attr("y",u).text(l).style("opacity",1e-6).transition().duration(k).delay(0).attr("y",_).style("opacity",1),f.transition().duration(k).delay(0).text(l).attr("x",v).attr("y",_).style("opacity",1),f.exit().transition().duration(k).delay(0).attr("y",_).style("opacity",1e-6).remove(),delete e.quartiles}}),c.timerFlush()}return e.width=function(t){return arguments.length?(v=t,e):v},e.height=function(t){return arguments.length?(C=t,e):C},e.tickFormat=function(t){return arguments.length?(D=t,e):D},e.showOutliers=function(t){return arguments.length?(P=t,e):P},e.boldOutlier=function(t){return arguments.length?(H=t,e):H},e.renderDataPoints=function(t){return arguments.length?(O=t,e):O},e.renderTitle=function(t){return arguments.length?(F=t,e):F},e.dataOpacity=function(t){return arguments.length?(B=t,e):B},e.dataWidthPortion=function(t){return arguments.length?($=t,e):$},e.duration=function(t){return arguments.length?(k=t,e):k},e.domain=function(t){return arguments.length?(S=null===t||"function"==typeof t?t:M.constant(t),e):S},e.value=function(t){return arguments.length?(w=t,e):w},e.whiskers=function(t){return arguments.length?(L=t,e):L},e.quartiles=function(t){return arguments.length?(R=t,e):R},e}function nt(t){return[0,t.length-1]}function lt(t){return[E.quantile(t,.25),E.quantile(t,.5),E.quantile(t,.75)]}class ot extends at{constructor(){super(),this._stackLayout=d.stack(),this._stack=[],this._titles={},this._hidableStacks=!1,this._evadeDomainFilter=!1,this.data(()=>{const s=this._stack.filter(this._visibility);if(!s.length)return[];s.forEach((t,e)=>this._prepareValues(t,e));var t=s[0].values.map((t,e)=>{const i={x:t.x};return s.forEach(t=>{i[t.name]=t.values[e].y}),i}),e=s.map(t=>t.name);const i=this.stackLayout().keys(e)(t);return i.forEach((t,i)=>{t.forEach((t,e)=>{s[i].values[e].y0=t[0],s[i].values[e].y1=t[1]})}),s}),this.colorAccessor(function(t){return this.layer||this.name||t.name||t.layer})}_prepareValues(i,t){const s=i.accessor||this.valueAccessor();i.name=String(i.name||t);const e=i.group.all().map((t,e)=>({x:this.keyAccessor()(t,e),y:i.hidden?null:s(t,e),data:t,layer:i.name,hidden:i.hidden}));i.domainValues=e.filter(t=>this._domainFilter()(t)),i.values=this.evadeDomainFilter()?e:i.domainValues}_domainFilter(){if(!this.x())return M.constant(!0);const e=this.x().domain();return this.isOrdinal()||this.elasticX()?()=>!0:t=>t.x>=e[0]&&t.x<=e[e.length-1]}stack(t,e,i){if(!arguments.length)return this._stack;arguments.length<=2&&(i=e);const s={group:t};return"string"==typeof e&&(s.name=e),"function"==typeof i&&(s.accessor=i),this._stack.push(s),this}group(t,e,i){return arguments.length?(this._stack=[],this._titles={},this.stack(t,e),i&&this.valueAccessor(i),super.group(t,e)):super.group()}hidableStacks(t){return arguments.length?(this._hidableStacks=t,this):this._hidableStacks}_findLayerByName(t){t=this._stack.map(H("name")).indexOf(t);return this._stack[t]}hideStack(t){const e=this._findLayerByName(t);return e&&(e.hidden=!0),this}showStack(t){const e=this._findLayerByName(t);return e&&(e.hidden=!1),this}getValueAccessorByIndex(t){return this._stack[t].accessor||this.valueAccessor()}yAxisMin(){var t=E.min(this._flattenStack(),t=>t.y<0?t.y+t.y0:t.y0);return M.subtract(t,this.yAxisPadding())}yAxisMax(){var t=E.max(this._flattenStack(),t=>0<t.y?t.y+t.y0:t.y0);return M.add(t,this.yAxisPadding())}_flattenStack(){var t=this.data().map(t=>t.domainValues);return[].concat(...t)}xAxisMin(){var t=E.min(this._flattenStack(),H("x"));return M.subtract(t,this.xAxisPadding(),this.xAxisPaddingUnit())}xAxisMax(){var t=E.max(this._flattenStack(),H("x"));return M.add(t,this.xAxisPadding(),this.xAxisPaddingUnit())}title(t,e){return t?"function"==typeof t?super.title(t):t===this._groupName&&"function"==typeof e?super.title(e):"function"!=typeof e?this._titles[t]||super.title():(this._titles[t]=e,this):super.title()}stackLayout(t){return arguments.length?(this._stackLayout=t,this):this._stackLayout}evadeDomainFilter(t){return arguments.length?(this._evadeDomainFilter=t,this):this._evadeDomainFilter}_visibility(t){return!t.hidden}_ordinalXDomain(){var t=this._flattenStack().map(H("data"));const e=this._computeOrderedGroups(t);return e.map(this.keyAccessor())}legendables(){return this._stack.map((t,e)=>({chart:this,name:t.name,hidden:t.hidden||!1,color:this.getColor.call(t,t.values,e)}))}isLegendableHidden(t){t=this._findLayerByName(t.name);return!!t&&t.hidden}legendToggle(t){this._hidableStacks&&(this.isLegendableHidden(t)?this.showStack(t.name):this.hideStack(t.name),this.redrawGroup())}}class ct extends ot{constructor(t,e){super(),this._gap=2,this._centerBar=!1,this._alwaysUseRounding=!1,this._barWidth=void 0,this.label(t=>M.printSingleValue(t.y0+t.y),!1),this.anchor(t,e)}outerPadding(t){return arguments.length?this._outerRangeBandPadding(t):this._outerRangeBandPadding()}rescale(){return super.rescale(),this._barWidth=void 0,this}render(){return this.round()&&this._centerBar&&!this._alwaysUseRounding&&b.warn("By default, brush rounding is disabled if bars are centered. See dc.js bar chart API documentation for details."),super.render()}plotData(){let t=this.chartBodyG().selectAll("g.stack").data(this.data());this._calculateBarWidth(),t=t.enter().append("g").attr("class",(t,e)=>`stack _${e}`).merge(t);const s=t.size()-1;{const r=this;t.each(function(t,e){var i=T.select(this);r._renderBars(i,e,t),r.renderLabel()&&s===e&&r._renderLabels(i,e,t)})}}_barHeight(t){return M.safeNumber(Math.abs(this.y()(t.y+t.y0)-this.y()(t.y0)))}_labelXPos(t){let e=this.x()(t.x);return this._centerBar||(e+=this._barWidth/2),this.isOrdinal()&&void 0!==this._gap&&(e+=this._gap/2),M.safeNumber(e)}_labelYPos(t){let e=this.y()(t.y+t.y0);return t.y<0&&(e-=this._barHeight(t)),M.safeNumber(e-3)}_renderLabels(t,e,i){const s=t.selectAll("text.barLabel").data(i.values,H("x")),r=s.enter().append("text").attr("class","barLabel").attr("text-anchor","middle").attr("x",t=>this._labelXPos(t)).attr("y",t=>this._labelYPos(t)).merge(s);this.isOrdinal()&&(r.on("click",C.eventHandler(t=>this.onClick(t))),r.attr("cursor","pointer")),D(r,this.transitionDuration(),this.transitionDelay()).attr("x",t=>this._labelXPos(t)).attr("y",t=>this._labelYPos(t)).text(t=>this.label()(t)),D(s.exit(),this.transitionDuration(),this.transitionDelay()).attr("height",0).remove()}_barXPos(t){let e=this.x()(t.x);return this._centerBar&&(e-=this._barWidth/2),this.isOrdinal()&&void 0!==this._gap&&(e+=this._gap/2),M.safeNumber(e)}_renderBars(t,e,i){const s=t.selectAll("rect.bar").data(i.values,H("x")),r=s.enter().append("rect").attr("class","bar").classed("dc-tabbable",this._keyboardAccessible).attr("fill",H("data",this.getColor)).attr("x",t=>this._barXPos(t)).attr("y",this.yAxisHeight()).attr("height",0),a=r.merge(s);this.renderTitle()&&r.append("title").text(H("data",this.title(i.name))),this.isOrdinal()&&a.on("click",C.eventHandler(t=>this.onClick(t))),this._keyboardAccessible&&this._makeKeyboardAccessible(this.onClick),D(a,this.transitionDuration(),this.transitionDelay()).attr("x",t=>this._barXPos(t)).attr("y",t=>{let e=this.y()(t.y+t.y0);return t.y<0&&(e-=this._barHeight(t)),M.safeNumber(e)}).attr("width",this._barWidth).attr("height",t=>this._barHeight(t)).attr("fill",H("data",this.getColor)).select("title").text(H("data",this.title(i.name))),D(s.exit(),this.transitionDuration(),this.transitionDelay()).attr("x",t=>this.x()(t.x)).attr("width",.9*this._barWidth).remove()}_calculateBarWidth(){var t;void 0===this._barWidth&&(t=this.xUnitCount(),this.isOrdinal()&&void 0===this._gap?this._barWidth=Math.floor(this.x().bandwidth()):this._gap?this._barWidth=Math.floor((this.xAxisLength()-(t-1)*this._gap)/t):this._barWidth=Math.floor(this.xAxisLength()/(1+this.barPadding())/t),(this._barWidth===1/0||isNaN(this._barWidth)||this._barWidth<1)&&(this._barWidth=1))}fadeDeselectedArea(t){const e=this.chartBodyG().selectAll("rect.bar");if(this.isOrdinal())this.hasFilter()?(e.classed(x.SELECTED_CLASS,t=>this.hasFilter(t.x)),e.classed(x.DESELECTED_CLASS,t=>!this.hasFilter(t.x))):(e.classed(x.SELECTED_CLASS,!1),e.classed(x.DESELECTED_CLASS,!1));else if(this.brushOn()||this.parentBrushOn())if(this.brushIsEmpty(t))e.classed(x.DESELECTED_CLASS,!1);else{const i=t[0],s=t[1];e.classed(x.DESELECTED_CLASS,t=>t.x<i||t.x>=s)}}centerBar(t){return arguments.length?(this._centerBar=t,this):this._centerBar}onClick(t){super.onClick(t.data)}barPadding(t){return arguments.length?(this._rangeBandPadding(t),this._gap=void 0,this):this._rangeBandPadding()}_useOuterPadding(){return void 0===this._gap}gap(t){return arguments.length?(this._gap=t,this):this._gap}extendBrush(t){return t&&this.round()&&(!this._centerBar||this._alwaysUseRounding)&&(t[0]=this.round()(t[0]),t[1]=this.round()(t[1])),t}alwaysUseRounding(t){return arguments.length?(this._alwaysUseRounding=t,this):this._alwaysUseRounding}legendHighlight(t){var e=(i,s)=>function(){const t=T.select(this);var e=t.attr("fill")===i;return s?!e:e};this.isLegendableHidden(t)||this.g().selectAll("rect.bar").classed("highlight",e(t.color)).classed("fadeout",e(t.color,!0))}legendReset(){this.g().selectAll("rect.bar").classed("highlight",!1).classed("fadeout",!1)}xAxisMax(){let t=super.xAxisMax();var e;return"resolution"in this.xUnits()&&(e=this.xUnits().resolution,t+=e),t}}function dt(h){return t=>{var e=t.quartiles[0],i=t.quartiles[2],s=(i-e)*h;let r=-1,a=t.length;for(;++r,t[r]<e-s;);for(;--a,t[a]>i+s;);return[r,a]}}class _t extends at{constructor(t,e){super(),this._whiskerIqrFactor=1.5,this._whiskersIqr=dt,this._whiskers=this._whiskersIqr(this._whiskerIqrFactor),this._box=ht(),this._tickFormat=null,this._renderDataPoints=!1,this._dataOpacity=.3,this._dataWidthPortion=.8,this._showOutliers=!0,this._boldOutlier=!1,this._yRangePadding=8,this._boxWidth=(t,e)=>this.isOrdinal()?this.x().bandwidth():t/(1+this.boxPadding())/e,this.x(z.scaleBand()),this.xUnits(Y.ordinal),this.data(t=>t.all().map(e=>(e.map=t=>t.call(e,e),e)).filter(t=>{return 0!==this.valueAccessor()(t).length})),this.boxPadding(.8),this.outerPadding(.5),this.anchor(t,e)}boxPadding(t){return arguments.length?this._rangeBandPadding(t):this._rangeBandPadding()}outerPadding(t){return arguments.length?this._outerRangeBandPadding(t):this._outerRangeBandPadding()}boxWidth(t){return arguments.length?(this._boxWidth="function"==typeof t?t:M.constant(t),this):this._boxWidth}_boxTransform(t,e){return`translate(${this.x()(this.keyAccessor()(t,e))}, 0)`}_preprocessData(){this.elasticX()&&this.x().domain([])}plotData(){this._calculatedBoxWidth=this._boxWidth(this.effectiveWidth(),this.xUnitCount()),this._box.whiskers(this._whiskers).width(this._calculatedBoxWidth).height(this.effectiveHeight()).value(this.valueAccessor()).domain(this.y().domain()).duration(this.transitionDuration()).tickFormat(this._tickFormat).renderDataPoints(this._renderDataPoints).dataOpacity(this._dataOpacity).dataWidthPortion(this._dataWidthPortion).renderTitle(this.renderTitle()).showOutliers(this._showOutliers).boldOutlier(this._boldOutlier);var t=this.chartBodyG().selectAll("g.box").data(this.data(),this.keyAccessor()),e=this._renderBoxes(t);this._updateBoxes(e),this._removeBoxes(t),this.fadeDeselectedArea(this.filter())}_renderBoxes(t){const e=t.enter().append("g");return e.attr("class","box").classed("dc-tabbable",this._keyboardAccessible).attr("transform",(t,e)=>this._boxTransform(t,e)).call(this._box).on("click",C.eventHandler(t=>{this.filter(this.keyAccessor()(t)),this.redrawGroup()})).selectAll("circle").classed("dc-tabbable",this._keyboardAccessible),this._keyboardAccessible&&this._makeKeyboardAccessible(this.onClick),e.merge(t)}_updateBoxes(t){const e=this;D(t,this.transitionDuration(),this.transitionDelay()).attr("transform",(t,e)=>this._boxTransform(t,e)).call(this._box).each(function(t){t=e.getColor(t,0);T.select(this).select("rect.box").attr("fill",t),T.select(this).selectAll("circle.data").attr("fill",t)})}_removeBoxes(t){t.exit().remove().call(this._box)}_minDataValue(){return E.min(this.data(),t=>E.min(this.valueAccessor()(t)))}_maxDataValue(){return E.max(this.data(),t=>E.max(this.valueAccessor()(t)))}_yAxisRangeRatio(){return(this._maxDataValue()-this._minDataValue())/this.effectiveHeight()}onClick(t){this.filter(this.keyAccessor()(t)),this.redrawGroup()}fadeDeselectedArea(t){const e=this;if(this.hasFilter()){if(this.isOrdinal())this.g().selectAll("g.box").each(function(t){e.isSelectedNode(t)?e.highlightSelected(this):e.fadeDeselected(this)});else if(this.brushOn()||this.parentBrushOn()){const i=t[0],s=t[1];this.g().selectAll("g.box").each(function(t){t=e.keyAccessor()(t);t<i||t>=s?e.fadeDeselected(this):e.highlightSelected(this)})}}else this.g().selectAll("g.box").each(function(){e.resetHighlight(this)})}isSelectedNode(t){return this.hasFilter(this.keyAccessor()(t))}yAxisMin(){var t=this._yRangePadding*this._yAxisRangeRatio();return M.subtract(this._minDataValue()-t,this.yAxisPadding())}yAxisMax(){var t=this._yRangePadding*this._yAxisRangeRatio();return M.add(this._maxDataValue()+t,this.yAxisPadding())}tickFormat(t){return arguments.length?(this._tickFormat=t,this):this._tickFormat}yRangePadding(t){return arguments.length?(this._yRangePadding=t,this):this._yRangePadding}renderDataPoints(t){return arguments.length?(this._renderDataPoints=t,this):this._renderDataPoints}dataOpacity(t){return arguments.length?(this._dataOpacity=t,this):this._dataOpacity}dataWidthPortion(t){return arguments.length?(this._dataWidthPortion=t,this):this._dataWidthPortion}showOutliers(t){return arguments.length?(this._showOutliers=t,this):this._showOutliers}boldOutlier(t){return arguments.length?(this._boldOutlier=t,this):this._boldOutlier}}class ut extends K(at){constructor(t,e){super(),this.transitionDuration(750),this.transitionDelay(0),this.anchor(t,e)}_bubbleLocator(t){return`translate(${this._bubbleX(t)},${this._bubbleY(t)})`}plotData(){this.calculateRadiusDomain(),this.r().range([this.MIN_RADIUS,this.xAxisLength()*this.maxBubbleRelativeSize()]);var t=this.data();let e=this.chartBodyG().selectAll(`g.${this.BUBBLE_NODE_CLASS}`).data(t,t=>t.key);(this.sortBubbleSize()||this.keyboardAccessible())&&e.order(),this._removeNodes(e),e=this._renderNodes(e),this._updateNodes(e),this.fadeDeselectedArea(this.filter())}_renderNodes(t){const e=t.enter().append("g");return e.attr("class",this.BUBBLE_NODE_CLASS).attr("transform",t=>this._bubbleLocator(t)).append("circle").attr("class",(t,e)=>`${this.BUBBLE_CLASS} _${e}`).on("click",C.eventHandler(t=>this.onClick(t))).classed("dc-tabbable",this._keyboardAccessible).attr("fill",this.getColor).attr("r",0),t=e.merge(t),D(t,this.transitionDuration(),this.transitionDelay()).select(`circle.${this.BUBBLE_CLASS}`).attr("r",t=>this.bubbleR(t)).attr("opacity",t=>0<this.bubbleR(t)?1:0),this._keyboardAccessible&&this._makeKeyboardAccessible(this.onClick),this._doRenderLabel(e),this._doRenderTitles(e),t}_updateNodes(t){D(t,this.transitionDuration(),this.transitionDelay()).attr("transform",t=>this._bubbleLocator(t)).select(`circle.${this.BUBBLE_CLASS}`).attr("fill",this.getColor).attr("r",t=>this.bubbleR(t)).attr("opacity",t=>0<this.bubbleR(t)?1:0),this.doUpdateLabels(t),this.doUpdateTitles(t)}_removeNodes(t){t.exit().remove()}_bubbleX(t){let e=this.x()(this.keyAccessor()(t));return!isNaN(e)&&isFinite(e)||(e=0),e}_bubbleY(t){let e=this.y()(this.valueAccessor()(t));return!isNaN(e)&&isFinite(e)||(e=0),e}renderBrush(){}redrawBrush(t,e){this.fadeDeselectedArea(t)}}const gt="bubble-overlay",pt="bubble";class yt extends K(q){constructor(t,e){super(),this._g=void 0,this._points=[],this._keyboardAccessible=!1,this.transitionDuration(750),this.transitionDelay(0),this.radiusValueAccessor(t=>t.value),this.anchor(t,e)}point(t,e,i){return this._points.push({name:t,x:e,y:i}),this}_doRender(){return this._g=this._initOverlayG(),this.r().range([this.MIN_RADIUS,this.width()*this.maxBubbleRelativeSize()]),this._initializeBubbles(),this.fadeDeselectedArea(this.filter()),this}_initOverlayG(){return this._g=this.select(`g.${gt}`),this._g.empty()&&(this._g=this.svg().append("g").attr("class",gt)),this._g}_initializeBubbles(){const s=this._mapData();this.calculateRadiusDomain(),this._points.forEach(t=>{const e=this._getNodeG(t,s);let i=e.select(`circle.${pt}`);i.empty()&&(i=e.append("circle").attr("class",pt).classed("dc-tabbable",this._keyboardAccessible).attr("r",0).attr("fill",this.getColor).on("click",C.eventHandler(t=>this.onClick(t)))),this._keyboardAccessible&&this._makeKeyboardAccessible(this.onClick),D(i,this.transitionDuration(),this.transitionDelay()).attr("r",t=>this.bubbleR(t)),this._doRenderLabel(e),this._doRenderTitles(e)})}_mapData(){const e={};return this.data().forEach(t=>{e[this.keyAccessor()(t)]=t}),e}_getNodeG(t,e){var i=`node ${M.nameToId(t.name)}`;let s=this._g.select(`g.${M.nameToId(t.name)}`);return s.empty()&&(s=this._g.append("g").attr("class",i).attr("transform",`translate(${t.x},${t.y})`)),s.datum(e[t.name]),s}_doRedraw(){return this._updateBubbles(),this.fadeDeselectedArea(this.filter()),this}_updateBubbles(){const i=this._mapData();this.calculateRadiusDomain(),this._points.forEach(t=>{const e=this._getNodeG(t,i);t=e.select(`circle.${pt}`);D(t,this.transitionDuration(),this.transitionDelay()).attr("r",t=>this.bubbleR(t)).attr("fill",this.getColor),this.doUpdateLabels(e),this.doUpdateTitles(e)})}debug(t){if(t){let i=this.select(`g.${x.DEBUG_GROUP_CLASS}`);i.empty()&&(i=this.svg().append("g").attr("class",x.DEBUG_GROUP_CLASS));const s=i.append("text").attr("x",10).attr("y",20);i.append("rect").attr("width",this.width()).attr("height",this.height()).on("mousemove",C.eventHandler((t,e)=>{e=C.pointer(e,i.node()),e=`${e[0]}, ${e[1]}`;s.text(e)}))}else this.selectAll(".debug").remove();return this}}const mt="dc-cbox-item";class xt extends q{constructor(t,e){super(),this._cbox=void 0,this._promptText="Select all",this._multiple=!1,this._inputType="radio",this._promptValue=null,this._uniqueId=M.uniqueId(),this.data(t=>t.all().filter(this._filterDisplayed)),this._filterDisplayed=t=>0<this.valueAccessor()(t),this._order=(t,e)=>this.keyAccessor()(t)>this.keyAccessor()(e)?1:this.keyAccessor()(t)<this.keyAccessor()(e)?-1:0,this.anchor(t,e)}_doRender(){return this._doRedraw()}_doRedraw(){return this.select("ul").remove(),this._cbox=this.root().append("ul").classed("dc-cbox-group",!0),this._renderOptions(),this.hasFilter()&&this._multiple?this._cbox.selectAll("input").property("checked",t=>t&&0<=this.filters().indexOf(String(this.keyAccessor()(t)))||!1):this.hasFilter()&&this._cbox.selectAll("input").property("checked",t=>!!t&&this.keyAccessor()(t)===this.filter()),this}_renderOptions(){let t=this._cbox.selectAll(`li.${mt}`).data(this.data(),t=>this.keyAccessor()(t));t.exit().remove(),t=t.enter().append("li").classed(mt,!0).merge(t),t.append("input").attr("type",this._inputType).attr("value",t=>this.keyAccessor()(t)).attr("name",`domain_${this._uniqueId}`).attr("id",(t,e)=>`input_${this._uniqueId}_${e}`),t.append("label").attr("for",(t,e)=>`input_${this._uniqueId}_${e}`).text(this.title());const i=this;if(this._multiple)this._cbox.append("li").append("input").attr("type","reset").text(this._promptText).on("click",C.eventHandler(function(t,e){return i._onChange(t,e,this)}));else{const e=this._cbox.append("li");e.append("input").attr("type",this._inputType).attr("value",this._promptValue).attr("name",`domain_${this._uniqueId}`).attr("id",(t,e)=>`input_${this._uniqueId}_all`).property("checked",!0),e.append("label").attr("for",(t,e)=>`input_${this._uniqueId}_all`).text(this._promptText)}return this._cbox.selectAll(`li.${mt}`).sort(this._order),this._cbox.on("change",C.eventHandler(function(t,e){return i._onChange(t,e,this)})),t}_onChange(t,e,i){let s;const r=T.select(e.target);let a;r.datum()?(a=T.select(i).selectAll("input").filter(function(t){if(t)return this.checked}),s=a.nodes().map(t=>t.value),this._multiple||1!==s.length||(s=s[0])):s=this._promptValue||null,this.onChange(s)}onChange(t){t&&this._multiple?this.replaceFilter([t]):t?this.replaceFilter(t):this.filterAll(),$.trigger(()=>{this.redrawGroup()})}order(t){return arguments.length?(this._order=t,this):this._order}promptText(t){return arguments.length?(this._promptText=t,this):this._promptText}filterDisplayed(t){return arguments.length?(this._filterDisplayed=t,this):this._filterDisplayed}multiple(t){return arguments.length?(this._multiple=t,this._multiple?this._inputType="checkbox":this._inputType="radio",this):this._multiple}promptValue(t){return arguments.length?(this._promptValue=t,this):this._promptValue}}class ft extends at{constructor(t,e){super(),this._children=[],this._childOptions={},this._shareColors=!1,this._shareTitle=!0,this._alignYAxes=!1,this._rightYAxis=n.axisRight(),this._rightYAxisLabel=0,this._rightYAxisLabelPadding=12,this._rightY=void 0,this._rightAxisGridLines=!1,this._mandatoryAttributes([]),this.transitionDuration(500),this.transitionDelay(0),this.on("filtered.dcjs-composite-chart",t=>{for(let t=0;t<this._children.length;++t)this._children[t].replaceFilter(this.filter())}),this.anchor(t,e)}_generateG(){var t=super._generateG();for(let t=0;t<this._children.length;++t){const e=this._children[t];this._generateChildG(e,t),e.dimension()||e.dimension(this.dimension()),e.group()||e.group(this.group()),e.chartGroup(this.chartGroup()),e.svg(this.svg()),e.xUnits(this.xUnits()),e.transitionDuration(this.transitionDuration(),this.transitionDelay()),e.parentBrushOn(this.brushOn()),e.brushOn(!1),e.renderTitle(this.renderTitle()),e.elasticX(this.elasticX())}return t}rescale(){return super.rescale(),this._children.forEach(t=>{t.rescale()}),this}resizing(e){return arguments.length?(super.resizing(e),this._children.forEach(t=>{t.resizing(e)}),this):super.resizing()}_prepareYAxis(){var t=0!==this._leftYAxisChildren().length,e=0!==this._rightYAxisChildren().length,i=this._calculateYAxisRanges(t,e);t&&this._prepareLeftYAxis(i),e&&this._prepareRightYAxis(i),0<this._leftYAxisChildren().length&&!this._rightAxisGridLines?this._renderHorizontalGridLinesForAxis(this.g(),this.y(),this.yAxis()):0<this._rightYAxisChildren().length&&this._renderHorizontalGridLinesForAxis(this.g(),this._rightY,this._rightYAxis)}renderYAxis(){0!==this._leftYAxisChildren().length&&(this.renderYAxisAt("y",this.yAxis(),this.margins().left),this.renderYAxisLabel("y",this.yAxisLabel(),-90)),0!==this._rightYAxisChildren().length&&(this.renderYAxisAt("yr",this.rightYAxis(),this.width()-this.margins().right),this.renderYAxisLabel("yr",this.rightYAxisLabel(),90,this.width()-this._rightYAxisLabelPadding))}_calculateYAxisRanges(t,e){let i,s,r,a,h;return t&&(i=this._yAxisMin(),s=this._yAxisMax()),e&&(r=this._rightYAxisMin(),a=this._rightYAxisMax()),this.alignYAxes()&&t&&e&&(h=this._alignYAxisRanges(i,s,r,a)),h||{lyAxisMin:i,lyAxisMax:s,ryAxisMin:r,ryAxisMax:a}}_alignYAxisRanges(t,e,i,s){var r=(s-i)/(e-t);return{lyAxisMin:Math.min(t,i/r),lyAxisMax:Math.max(e,s/r),ryAxisMin:Math.min(i,t*r),ryAxisMax:Math.max(s,e*r)}}_prepareRightYAxis(t){var e=void 0===this.rightY()||this.elasticY(),i=e||this.resizing();void 0===this.rightY()&&this.rightY(z.scaleLinear()),e&&this.rightY().domain([t.ryAxisMin,t.ryAxisMax]),i&&this.rightY().rangeRound([this.yAxisHeight(),0]),this.rightY().range([this.yAxisHeight(),0]),this.rightYAxis(this.rightYAxis().scale(this.rightY()))}_prepareLeftYAxis(t){var e=void 0===this.y()||this.elasticY(),i=e||this.resizing();void 0===this.y()&&this.y(z.scaleLinear()),e&&this.y().domain([t.lyAxisMin,t.lyAxisMax]),i&&this.y().rangeRound([this.yAxisHeight(),0]),this.y().range([this.yAxisHeight(),0]),this.yAxis(this.yAxis().scale(this.y()))}_generateChildG(t,e){t._generateG(this.g()),t.g().attr("class",`sub _${e}`)}plotData(){for(let t=0;t<this._children.length;++t){const e=this._children[t];e.g()||this._generateChildG(e,t),this._shareColors&&e.colors(this.colors()),e.x(this.x()),e.xAxis(this.xAxis()),e.useRightYAxis()?(e.y(this.rightY()),e.yAxis(this.rightYAxis())):(e.y(this.y()),e.yAxis(this.yAxis())),e.plotData(),e._activateRenderlets()}}useRightAxisGridLines(t){return arguments?(this._rightAxisGridLines=t,this):this._rightAxisGridLines}childOptions(t){return arguments.length?(this._childOptions=t,this._children.forEach(t=>{t.options(this._childOptions)}),this):this._childOptions}fadeDeselectedArea(e){if(this.brushOn())for(let t=0;t<this._children.length;++t){const i=this._children[t];i.fadeDeselectedArea(e)}}rightYAxisLabel(t,e){return arguments.length?(this._rightYAxisLabel=t,this.margins().right-=this._rightYAxisLabelPadding,this._rightYAxisLabelPadding=void 0===e?12:e,this.margins().right+=this._rightYAxisLabelPadding,this):this._rightYAxisLabel}compose(t){return this._children=t,this._children.forEach(t=>{t.height(this.height()),t.width(this.width()),t.margins(this.margins()),this._shareTitle&&t.title(this.title()),t.options(this._childOptions)}),this.rescale(),this}_setChildrenProperty(e,i){this._children.forEach(t=>{t[e](i)})}height(t){return arguments.length?(super.height(t),this._setChildrenProperty("height",t),this):super.height()}width(t){return arguments.length?(super.width(t),this._setChildrenProperty("width",t),this):super.width()}margins(t){return arguments.length?(super.margins(t),this._setChildrenProperty("margins",t),this):super.margins()}children(){return this._children}shareColors(t){return arguments.length?(this._shareColors=t,this):this._shareColors}shareTitle(t){return arguments.length?(this._shareTitle=t,this):this._shareTitle}rightY(t){return arguments.length?(this._rightY=t,this.rescale(),this):this._rightY}alignYAxes(t){return arguments.length?(this._alignYAxes=t,this.rescale(),this):this._alignYAxes}_leftYAxisChildren(){return this._children.filter(t=>!t.useRightYAxis())}_rightYAxisChildren(){return this._children.filter(t=>t.useRightYAxis())}_getYAxisMin(t){return t.map(t=>t.yAxisMin())}_yAxisMin(){return E.min(this._getYAxisMin(this._leftYAxisChildren()))}_rightYAxisMin(){return E.min(this._getYAxisMin(this._rightYAxisChildren()))}_getYAxisMax(t){return t.map(t=>t.yAxisMax())}_yAxisMax(){return M.add(E.max(this._getYAxisMax(this._leftYAxisChildren())),this.yAxisPadding())}_rightYAxisMax(){return M.add(E.max(this._getYAxisMax(this._rightYAxisChildren())),this.yAxisPadding())}_getAllXAxisMinFromChildCharts(){return this._children.map(t=>t.xAxisMin())}xAxisMin(){return M.subtract(E.min(this._getAllXAxisMinFromChildCharts()),this.xAxisPadding(),this.xAxisPaddingUnit())}_getAllXAxisMaxFromChildCharts(){return this._children.map(t=>t.xAxisMax())}xAxisMax(){return M.add(E.max(this._getAllXAxisMaxFromChildCharts()),this.xAxisPadding(),this.xAxisPaddingUnit())}legendables(){return this._children.reduce((t,e)=>(this._shareColors&&e.colors(this.colors()),t.push.apply(t,e.legendables()),t),[])}legendHighlight(e){for(let t=0;t<this._children.length;++t){const i=this._children[t];i.legendHighlight(e)}}legendReset(e){for(let t=0;t<this._children.length;++t){const i=this._children[t];i.legendReset(e)}}legendToggle(){console.log("composite should not be getting legendToggle itself")}rightYAxis(t){return arguments.length?(this._rightYAxis=t,this):this._rightYAxis}yAxisMin(){throw new Error("Not supported for this chart type")}yAxisMax(){throw new Error("Not supported for this chart type")}}class bt extends q{constructor(t,e){super(),this._formatNumber=i.format(",d"),this._crossfilter=null,this._groupAll=null,this._html={some:"",all:""},this._mandatoryAttributes(["crossfilter","groupAll"]),this.anchor(t,e)}html(t){return arguments.length?(t.all&&(this._html.all=t.all),t.some&&(this._html.some=t.some),this):this._html}formatNumber(t){return arguments.length?(this._formatNumber=t,this):this._formatNumber}_doRender(){var t=this.crossfilter().size(),e=this.groupAll().value(),i=this._formatNumber(t),s=this._formatNumber(e);return t===e&&""!==this._html.all?this.root().html(this._html.all.replace("%total-count",i).replace("%filter-count",s)):""!==this._html.some?this.root().html(this._html.some.replace("%total-count",i).replace("%filter-count",s)):(this.selectAll(".total-count").text(i),this.selectAll(".filter-count").text(s)),this}_doRedraw(){return this._doRender()}crossfilter(t){return arguments.length?(this._crossfilter=t,this):this._crossfilter}dimension(t){return b.warnOnce("consider using dataCount.crossfilter instead of dataCount.dimension for clarity"),arguments.length?this.crossfilter(t):this.crossfilter()}groupAll(t){return arguments.length?(this._groupAll=t,this):this._groupAll}group(t){return b.warnOnce("consider using dataCount.groupAll instead of dataCount.group for clarity"),arguments.length?this.groupAll(t):this.groupAll()}}const At="dc-grid-item",vt="dc-grid-top";class Ct extends q{constructor(t,e){super(),this._section=null,this._size=999,this._html=function(t){return`you need to provide an html() handling param:  ${JSON.stringify(t)}`},this._sortBy=function(t){return t},this._order=E.ascending,this._beginSlice=0,this._endSlice=void 0,this._htmlSection=t=>`<div class='dc-grid-section dc-grid-group'><h1 class='dc-grid-label'>${this.keyAccessor()(t)}</h1></div>`,this._mandatoryAttributes(["dimension","section"]),this.anchor(t,e)}_doRender(){return this.selectAll(`div.${vt}`).remove(),this._renderItems(this._renderSections()),this}_renderSections(){const t=this.root().selectAll(`div.${vt}`).data(this._nestEntries(),t=>this.keyAccessor()(t)),e=t.enter().append("div").attr("class",vt);return this._htmlSection&&e.html(t=>this._htmlSection(t)),t.exit().remove(),e}_nestEntries(){let t=this.dimension().top(this._size);return t=t.sort((t,e)=>this._order(this._sortBy(t),this._sortBy(e))).slice(this._beginSlice,this._endSlice),C.nester({key:this.section(),sortKeys:this._order,entries:t})}_renderItems(t){let e=t.order().selectAll(`div.${At}`).data(t=>t.values);return e.exit().remove(),e=e.enter().append("div").attr("class",At).html(t=>this._html(t)).merge(e),e}_doRedraw(){return this._doRender()}section(t){return arguments.length?(this._section=t,this):this._section}group(t){return b.warnOnce("consider using dataGrid.section instead of dataGrid.group for clarity"),arguments.length?this.section(t):this.section()}beginSlice(t){return arguments.length?(this._beginSlice=t,this):this._beginSlice}endSlice(t){return arguments.length?(this._endSlice=t,this):this._endSlice}size(t){return arguments.length?(this._size=t,this):this._size}html(t){return arguments.length?(this._html=t,this):this._html}htmlSection(t){return arguments.length?(this._htmlSection=t,this):this._htmlSection}htmlGroup(t){return b.warnOnce("consider using dataGrid.htmlSection instead of dataGrid.htmlGroup for clarity"),arguments.length?this.htmlSection(t):this.htmlSection()}sortBy(t){return arguments.length?(this._sortBy=t,this):this._sortBy}order(t){return arguments.length?(this._order=t,this):this._order}}const kt="dc-table-row";class St extends q{constructor(t,e){super(),this._size=25,this._columns=[],this._sortBy=t=>t,this._order=E.ascending,this._beginSlice=0,this._endSlice=void 0,this._showSections=!0,this._section=()=>"",this._mandatoryAttributes(["dimension"]),this.anchor(t,e)}_doRender(){return this.selectAll("tbody").remove(),this._renderRows(this._renderSections()),this}_doColumnValueFormat(t,e){return"function"==typeof t?t(e):"string"==typeof t?e[t]:t.format(e)}_doColumnHeaderFormat(t){return"function"==typeof t?this._doColumnHeaderFnToString(t):"string"==typeof t?this._doColumnHeaderCapitalize(t):String(t.label)}_doColumnHeaderCapitalize(t){return t.charAt(0).toUpperCase()+t.slice(1)}_doColumnHeaderFnToString(t){let e=String(t);var i=e.indexOf("return ");return 0<=i&&(0<=(t=e.lastIndexOf(";"))&&(e=e.substring(i+7,t),0<=e.indexOf("numberFormat")&&(e=e.replace("numberFormat","")))),e}_renderSections(){let e=!0;if(this._columns.forEach(t=>{e&="function"==typeof t}),!e){let t=this.selectAll("thead").data([0]);t.exit().remove(),t=t.enter().append("thead").merge(t);let e=t.selectAll("tr").data([0]);e.exit().remove(),e=e.enter().append("tr").merge(e);const s=e.selectAll("th").data(this._columns);s.exit().remove(),s.enter().append("th").merge(s).attr("class","dc-table-head").html(t=>this._doColumnHeaderFormat(t))}const t=this.root().selectAll("tbody").data(this._nestEntries(),t=>this.keyAccessor()(t)),i=t.enter().append("tbody");return!0===this._showSections&&i.append("tr").attr("class","dc-table-section dc-table-group").append("td").attr("class","dc-table-label").attr("colspan",this._columns.length).html(t=>this.keyAccessor()(t)),t.exit().remove(),i}_nestEntries(){let t;return t=this._order===E.ascending?this.dimension().bottom(this._size):this.dimension().top(this._size),t=t.sort((t,e)=>this._order(this._sortBy(t),this._sortBy(e))).slice(this._beginSlice,this._endSlice),C.nester({key:this.section(),sortKeys:this._order,entries:t})}_renderRows(t){const e=t.order().selectAll(`tr.${kt}`).data(t=>t.values),i=e.enter().append("tr").attr("class",kt);return this._columns.forEach((e,t)=>{i.append("td").attr("class",`dc-table-column _${t}`).html(t=>this._doColumnValueFormat(e,t))}),e.exit().remove(),e}_doRedraw(){return this._doRender()}section(t){return arguments.length?(this._section=t,this):this._section}group(t){return b.warnOnce("consider using dataTable.section instead of dataTable.group for clarity"),arguments.length?this.section(t):this.section()}size(t){return arguments.length?(this._size=t,this):this._size}beginSlice(t){return arguments.length?(this._beginSlice=t,this):this._beginSlice}endSlice(t){return arguments.length?(this._endSlice=t,this):this._endSlice}columns(t){return arguments.length?(this._columns=t,this):this._columns}sortBy(t){return arguments.length?(this._sortBy=t,this):this._sortBy}order(t){return arguments.length?(this._order=t,this):this._order}showSections(t){return arguments.length?(this._showSections=t,this):this._showSections}showGroups(t){return b.warnOnce("consider using dataTable.showSections instead of dataTable.showGroups for clarity"),arguments.length?this.showSections(t):this.showSections()}}class wt extends j(q){constructor(t,e){super(),this.colorAccessor(t=>t||0),this._geoPath=_.geoPath(),this._projectionFlag=void 0,this._projection=void 0,this._geoJsons=[],this.anchor(t,e)}_doRender(){this.resetSvg();for(let e=0;e<this._geoJsons.length;++e){const i=this.svg().append("g").attr("class",`layer${e}`);let t=i.selectAll(`g.${this._geoJson(e).name}`).data(this._geoJson(e).data);t=t.enter().append("g").attr("class",this._geoJson(e).name).merge(t),t.append("path").classed("dc-tabbable",this._keyboardAccessible).attr("fill","white").attr("d",this._getGeoPath()),t.append("title"),this._plotData(e)}this._projectionFlag=!1}_plotData(t){var e,i=this._generateLayeredData();this._isDataLayer(t)&&(e=this._renderRegionG(t),this._renderPaths(e,t,i),this._renderTitles(e,t,i))}_generateLayeredData(){const e={};var i=this.data();for(let t=0;t<i.length;++t)e[this.keyAccessor()(i[t])]=this.valueAccessor()(i[t]);return e}_isDataLayer(t){return this._geoJson(t).keyAccessor}_renderRegionG(i){return this.svg().selectAll(this._layerSelector(i)).classed("selected",t=>this._isSelected(i,t)).classed("deselected",t=>this._isDeselected(i,t)).attr("class",t=>{let e=`${this._geoJson(i).name} ${M.nameToId(this._geoJson(i).keyAccessor(t))}`;return this._isSelected(i,t)&&(e+=" selected"),this._isDeselected(i,t)&&(e+=" deselected"),e})}_layerSelector(t){return`g.layer${t} g.${this._geoJson(t).name}`}_isSelected(t,e){return this.hasFilter()&&this.hasFilter(this._getKey(t,e))}_isDeselected(t,e){return this.hasFilter()&&!this.hasFilter(this._getKey(t,e))}_getKey(t,e){return this._geoJson(t).keyAccessor(e)}_geoJson(t){return this._geoJsons[t]}_renderPaths(t,i,s){t=t.select("path").attr("fill",function(){var t=T.select(this).attr("fill");return t||"none"}).on("click",C.eventHandler(t=>this.onClick(t,i)));this._keyboardAccessible&&this._makeKeyboardAccessible(this.onClick,i),D(t,this.transitionDuration(),this.transitionDelay()).attr("fill",(t,e)=>this.getColor(s[this._geoJson(i).keyAccessor(t)],e))}onClick(t,e){const i=this._geoJson(e).keyAccessor(t);$.trigger(()=>{this.filter(i),this.redrawGroup()})}_renderTitles(t,i,s){this.renderTitle()&&t.selectAll("title").text(t=>{var e=this._getKey(i,t),t=s[e];return this.title()({key:e,value:t})})}_doRedraw(){for(let t=0;t<this._geoJsons.length;++t)this._plotData(t),this._projectionFlag&&this.svg().selectAll(`g.${this._geoJson(t).name} path`).attr("d",this._getGeoPath());this._projectionFlag=!1}overlayGeoJson(e,i,s){for(let t=0;t<this._geoJsons.length;++t)if(this._geoJsons[t].name===i)return this._geoJsons[t].data=e,this._geoJsons[t].keyAccessor=s,this;return this._geoJsons.push({name:i,data:e,keyAccessor:s}),this}projection(t){return arguments.length?(this._projection=t,this._projectionFlag=!0,this):this._projection}_getGeoPath(){return void 0===this._projection?(b.warn("choropleth projection default of geoAlbers is deprecated, in next version projection will need to be set explicitly"),this._geoPath.projection(_.geoAlbersUsa())):this._geoPath.projection(this._projection)}geoJsons(){return this._geoJsons}geoPath(){return this._geoPath}removeGeoJson(e){const i=[];for(let t=0;t<this._geoJsons.length;++t){var s=this._geoJsons[t];s.name!==e&&i.push(s)}return this._geoJsons=i,this}}class Lt extends j(J){constructor(t,e){super(),this._chartBody=void 0,this._cols=void 0,this._rows=void 0,this._colOrdering=E.ascending,this._rowOrdering=E.ascending,this._colScale=z.scaleBand(),this._rowScale=z.scaleBand(),this._xBorderRadius=6.75,this._yBorderRadius=6.75,this._mandatoryAttributes(["group"]),this.title(this.colorAccessor()),this._colsLabel=t=>t,this._rowsLabel=t=>t,this._xAxisOnClick=t=>{this._filterAxis(0,t)},this._yAxisOnClick=t=>{this._filterAxis(1,t)},this._boxOnClick=t=>{const e=t.key;$.trigger(()=>{this.filter(F.TwoDimensionalFilter(e)),this.redrawGroup()})},this.anchor(t,e)}colsLabel(t){return arguments.length?(this._colsLabel=t,this):this._colsLabel}rowsLabel(t){return arguments.length?(this._rowsLabel=t,this):this._rowsLabel}_filterAxis(e,i){const s=this.selectAll(".box-group").filter(t=>t.key[e]===i),r=s.filter(t=>!this.hasFilter(t.key));$.trigger(()=>{const t=r.empty()?s:r;var e=t.data().map(t=>F.TwoDimensionalFilter(t.key));this.filter([e]),this.redrawGroup()})}filter(t){var e=t=>(b.warnOnce("heatmap.filter taking a coordinate is deprecated - please pass dc.filters.TwoDimensionalFilter instead"),this._filter(F.TwoDimensionalFilter(t)));return arguments.length?null===t||"TwoDimensionalFilter"===t.filterType||Array.isArray(t)&&Array.isArray(t[0])&&"TwoDimensionalFilter"===t[0][0].filterType?super.filter(t):e(t):super.filter()}rows(t){return arguments.length?(this._rows=t,this):this._rows}rowOrdering(t){return arguments.length?(this._rowOrdering=t,this):this._rowOrdering}cols(t){return arguments.length?(this._cols=t,this):this._cols}colOrdering(t){return arguments.length?(this._colOrdering=t,this):this._colOrdering}_doRender(){return this.resetSvg(),this._chartBody=this.svg().append("g").attr("class","heatmap").attr("transform",`translate(${this.margins().left},${this.margins().top})`),this._doRedraw()}_doRedraw(){const t=this.data();let i=this.rows()||t.map(this.valueAccessor()),s=this.cols()||t.map(this.keyAccessor());this._rowOrdering&&(i=i.sort(this._rowOrdering)),this._colOrdering&&(s=s.sort(this._colOrdering)),i=this._rowScale.domain(i),s=this._colScale.domain(s);const e=i.domain().length,r=s.domain().length,a=Math.floor(this.effectiveWidth()/r),h=Math.floor(this.effectiveHeight()/e);s.rangeRound([0,this.effectiveWidth()]),i.rangeRound([this.effectiveHeight(),0]);let n=this._chartBody.selectAll("g.box-group").data(this.data(),(t,e)=>`${this.keyAccessor()(t,e)}\0${this.valueAccessor()(t,e)}`);n.exit().remove();const l=n.enter().append("g").attr("class","box-group");l.append("rect").attr("class","heat-box").classed("dc-tabbable",this._keyboardAccessible).attr("fill","white").attr("x",(t,e)=>s(this.keyAccessor()(t,e))).attr("y",(t,e)=>i(this.valueAccessor()(t,e))).on("click",C.eventHandler(this.boxOnClick())),this._keyboardAccessible&&this._makeKeyboardAccessible(this.boxOnClick),n=l.merge(n),this.renderTitle()&&(l.append("title"),n.select("title").text(this.title())),D(n.select("rect"),this.transitionDuration(),this.transitionDelay()).attr("x",(t,e)=>s(this.keyAccessor()(t,e))).attr("y",(t,e)=>i(this.valueAccessor()(t,e))).attr("rx",this._xBorderRadius).attr("ry",this._yBorderRadius).attr("fill",this.getColor).attr("width",a).attr("height",h);let o=this._chartBody.select("g.cols");o.empty()&&(o=this._chartBody.append("g").attr("class","cols axis"));let c=o.selectAll("text").data(s.domain());c.exit().remove(),c=c.enter().append("text").attr("x",t=>s(t)+a/2).style("text-anchor","middle").attr("y",this.effectiveHeight()).attr("dy",12).on("click",C.eventHandler(this.xAxisOnClick())).text(this.colsLabel()).merge(c),D(c,this.transitionDuration(),this.transitionDelay()).text(this.colsLabel()).attr("x",t=>s(t)+a/2).attr("y",this.effectiveHeight());let d=this._chartBody.select("g.rows");d.empty()&&(d=this._chartBody.append("g").attr("class","rows axis"));let _=d.selectAll("text").data(i.domain());if(_.exit().remove(),_=_.enter().append("text").style("text-anchor","end").attr("x",0).attr("dx",-2).attr("y",t=>i(t)+h/2).attr("dy",6).on("click",C.eventHandler(this.yAxisOnClick())).text(this.rowsLabel()).merge(_),D(_,this.transitionDuration(),this.transitionDelay()).text(this.rowsLabel()).attr("y",t=>i(t)+h/2),this.hasFilter()){const u=this;this.selectAll("g.box-group").each(function(t){u.isSelectedNode(t)?u.highlightSelected(this):u.fadeDeselected(this)})}else{const g=this;this.selectAll("g.box-group").each(function(){g.resetHighlight(this)})}return this}boxOnClick(t){return arguments.length?(this._boxOnClick=t,this):this._boxOnClick}xAxisOnClick(t){return arguments.length?(this._xAxisOnClick=t,this):this._xAxisOnClick}yAxisOnClick(t){return arguments.length?(this._yAxisOnClick=t,this):this._yAxisOnClick}xBorderRadius(t){return arguments.length?(this._xBorderRadius=t,this):this._xBorderRadius}yBorderRadius(t){return arguments.length?(this._yBorderRadius=t,this):this._yBorderRadius}isSelectedNode(t){return this.hasFilter(t.key)}}class Rt{constructor(){this._htmlLegendDivCssClass="dc-html-legend",this._legendItemCssClassHorizontal="dc-legend-item-horizontal",this._legendItemCssClassVertical="dc-legend-item-vertical",this._parent=void 0,this._container=void 0,this._legendText=H("name"),this._maxItems=void 0,this._horizontal=!1,this._legendItemClass=void 0,this._highlightSelected=!1,this._keyboardAccessible=!1}parent(t){return arguments.length?(this._parent=t,this):this._parent}render(){this._defaultLegendItemCssClass=this._horizontal?this._legendItemCssClassHorizontal:this._legendItemCssClassVertical,this._container.select(`div.${this._htmlLegendDivCssClass}`).remove();const t=this._container.append("div").attr("class",this._htmlLegendDivCssClass);t.attr("style",`max-width:${this._container.nodes()[0].style.width}`);let e=this._parent.legendables();const i=this._parent.filters();void 0!==this._maxItems&&(e=e.slice(0,this._maxItems));var s=this._legendItemClass||this._defaultLegendItemCssClass;const r=t.selectAll(`div.${s}`).data(e).enter().append("div").classed(s,!0).on("mouseover",C.eventHandler(t=>this._parent.legendHighlight(t))).on("mouseout",C.eventHandler(t=>this._parent.legendReset(t))).on("click",C.eventHandler(t=>this._parent.legendToggle(t)));this._highlightSelected&&r.classed(x.SELECTED_CLASS,t=>-1!==i.indexOf(t.name)),r.append("span").attr("class","dc-legend-item-color").style("background-color",H("color")),r.append("span").attr("class","dc-legend-item-label").classed("dc-tabbable",this._keyboardAccessible).attr("title",this._legendText).text(this._legendText),this._keyboardAccessible&&this._makeLegendKeyboardAccessible()}container(t){return arguments.length?(this._container=T.select(t),this):this._container}legendItemClass(t){return arguments.length?(this._legendItemClass=t,this):this._legendItemClass}highlightSelected(t){return arguments.length?(this._highlightSelected=t,this):this._highlightSelected}horizontal(t){return arguments.length?(this._horizontal=t,this):this._horizontal}legendText(t){return arguments.length?(this._legendText=t,this):this._legendText}maxItems(t){return arguments.length?(this._maxItems=M.isNumber(t)?t:void 0,this):this._maxItems}keyboardAccessible(t){return arguments.length?(this._keyboardAccessible=t,this):this._keyboardAccessible}_makeLegendKeyboardAccessible(){this._parent._svgDescription||(this._parent.svg().append("desc").attr("id",`desc-id-${this._parent.__dcFlag__}`).html(`${this._parent.svgDescription()}`),this._parent.svg().attr("tabindex","0").attr("role","img").attr("aria-labelledby",`desc-id-${this._parent.__dcFlag__}`));const t=this.container().selectAll(".dc-legend-item-label.dc-tabbable").attr("tabindex",0);t.on("keydown",C.eventHandler((t,e)=>{13===e.keyCode&&"object"==typeof t&&t.chart.legendToggle(t),32===e.keyCode&&"object"==typeof t&&(t.chart.legendToggle(t),e.preventDefault())})).on("focus",C.eventHandler(t=>{this._parent.legendHighlight(t)})).on("blur",C.eventHandler(t=>{this._parent.legendReset(t)}))}}class Dt{constructor(){this._parent=void 0,this._x=0,this._y=0,this._itemHeight=12,this._gap=5,this._horizontal=!1,this._legendWidth=560,this._itemWidth=70,this._autoItemWidth=!1,this._legendText=H("name"),this._maxItems=void 0,this._highlightSelected=!1,this._keyboardAccessible=!1,this._g=void 0}parent(t){return arguments.length?(this._parent=t,this):this._parent}x(t){return arguments.length?(this._x=t,this):this._x}y(t){return arguments.length?(this._y=t,this):this._y}gap(t){return arguments.length?(this._gap=t,this):this._gap}highlightSelected(t){return arguments.length?(this._highlightSelected=t,this):this._highlightSelected}itemHeight(t){return arguments.length?(this._itemHeight=t,this):this._itemHeight}horizontal(t){return arguments.length?(this._horizontal=t,this):this._horizontal}legendWidth(t){return arguments.length?(this._legendWidth=t,this):this._legendWidth}itemWidth(t){return arguments.length?(this._itemWidth=t,this):this._itemWidth}autoItemWidth(t){return arguments.length?(this._autoItemWidth=t,this):this._autoItemWidth}legendText(t){return arguments.length?(this._legendText=t,this):this._legendText}maxItems(t){return arguments.length?(this._maxItems=M.isNumber(t)?t:void 0,this):this._maxItems}keyboardAccessible(t){return arguments.length?(this._keyboardAccessible=t,this):this._keyboardAccessible}_legendItemHeight(){return this._gap+this._itemHeight}_makeLegendKeyboardAccessible(){this._parent._svgDescription||(this._parent.svg().append("desc").attr("id",`desc-id-${this._parent.__dcFlag__}`).html(`${this._parent.svgDescription()}`),this._parent.svg().attr("tabindex","0").attr("role","img").attr("aria-labelledby",`desc-id-${this._parent.__dcFlag__}`));const t=this._parent.svg().selectAll(".dc-legend .dc-tabbable").attr("tabindex",0);t.on("keydown",C.eventHandler((t,e)=>{13===e.keyCode&&"object"==typeof t&&t.chart.legendToggle(t),32===e.keyCode&&"object"==typeof t&&(t.chart.legendToggle(t),e.preventDefault())})).on("focus",C.eventHandler(t=>{this._parent.legendHighlight(t)})).on("blur",C.eventHandler(t=>{this._parent.legendReset(t)}))}render(){this._parent.svg().select("g.dc-legend").remove(),this._g=this._parent.svg().append("g").attr("class","dc-legend").attr("transform",`translate(${this._x},${this._y})`);let t=this._parent.legendables();const e=this._parent.filters();void 0!==this._maxItems&&(t=t.slice(0,this._maxItems));const i=this._g.selectAll("g.dc-legend-item").data(t).enter().append("g").attr("class","dc-legend-item").on("mouseover",C.eventHandler(t=>{this._parent.legendHighlight(t)})).on("mouseout",C.eventHandler(t=>{this._parent.legendReset(t)})).on("click",C.eventHandler(t=>{t.chart.legendToggle(t)}));this._highlightSelected&&i.classed(x.SELECTED_CLASS,t=>-1!==e.indexOf(t.name)),this._g.selectAll("g.dc-legend-item").classed("fadeout",t=>t.chart.isLegendableHidden(t)),t.some(H("dashstyle"))?i.append("line").attr("x1",0).attr("y1",this._itemHeight/2).attr("x2",this._itemHeight).attr("y2",this._itemHeight/2).attr("stroke-width",2).attr("stroke-dasharray",H("dashstyle")).attr("stroke",H("color")):i.append("rect").attr("width",this._itemHeight).attr("height",this._itemHeight).attr("fill",t=>t?t.color:"blue");{const s=this;i.append("text").text(s._legendText).classed("dc-tabbable",this._keyboardAccessible).attr("x",s._itemHeight+2).attr("y",function(){return s._itemHeight/2+(this.clientHeight||13)/2-2}),this._keyboardAccessible&&this._makeLegendKeyboardAccessible()}let r=0,a=0;{const h=this;i.attr("transform",function(t,e){if(h._horizontal){var i=!0===h._autoItemWidth?this.getBBox().width+h._gap:h._itemWidth;r+i>h._legendWidth&&0<r&&(++a,r=0);var s=`translate(${r},${a*h._legendItemHeight()})`;return r+=i,s}return`translate(0,${e*h._legendItemHeight()})`})}}}const Ot="dc-tooltip",Bt="yRef",$t="xRef";class Ft extends ot{constructor(t,e){super(),this._renderArea=!1,this._dotRadius=5,this._dataPointRadius=null,this._dataPointFillOpacity=1e-6,this._dataPointStrokeOpacity=1e-6,this._curve=null,this._interpolate=null,this._tension=null,this._defined=void 0,this._dashStyle=void 0,this._xyTipsOn=!0,this.transitionDuration(500),this.transitionDelay(0),this._rangeBandPadding(1),this.label(t=>M.printSingleValue(t.y0+t.y),!1),this.anchor(t,e)}plotData(){const t=this.chartBodyG();let e=t.select("g.stack-list");e.empty()&&(e=t.append("g").attr("class","stack-list"));let i=e.selectAll("g.stack").data(this.data());const s=i.enter().append("g").attr("class",(t,e)=>`stack _${e}`);i=s.merge(i),this._drawLine(s,i),this._drawArea(s,i),this._drawDots(t,i),this.renderLabel()&&this._drawLabels(i)}curve(t){return arguments.length?(this._curve=t,this):this._curve}interpolate(t){return b.warnOnce("dc.lineChart.interpolate has been deprecated since version 3.0 use dc.lineChart.curve instead"),arguments.length?(this._interpolate=t,this):this._interpolate}tension(t){return b.warnOnce("dc.lineChart.tension has been deprecated since version 3.0 use dc.lineChart.curve instead"),arguments.length?(this._tension=t,this):this._tension}defined(t){return arguments.length?(this._defined=t,this):this._defined}dashStyle(t){return arguments.length?(this._dashStyle=t,this):this._dashStyle}renderArea(t){return arguments.length?(this._renderArea=t,this):this._renderArea}_getColor(t,e){return this.getColor.call(t,t.values,e)}_getCurveFactory(){let t=null;return this._curve||(t="function"==typeof this._interpolate?this._interpolate:{linear:d.curveLinear,"linear-closed":d.curveLinearClosed,step:d.curveStep,"step-before":d.curveStepBefore,"step-after":d.curveStepAfter,basis:d.curveBasis,"basis-open":d.curveBasisOpen,"basis-closed":d.curveBasisClosed,bundle:d.curveBundle,cardinal:d.curveCardinal,"cardinal-open":d.curveCardinalOpen,"cardinal-closed":d.curveCardinalClosed,monotone:d.curveMonotoneX}[this._interpolate],t=t||d.curveLinear,null!==this._tension&&("function"!=typeof t.tension?b.warn("tension was specified but the curve/interpolate does not support it."):t=t.tension(this._tension)),t)}_drawLine(t,e){const i=d.line().x(t=>this.x()(t.x)).y(t=>this.y()(t.y+t.y0)).curve(this._getCurveFactory());this._defined&&i.defined(this._defined);const s=t.append("path").attr("class","line").attr("stroke",(t,e)=>this._getColor(t,e));this._dashStyle&&s.attr("stroke-dasharray",this._dashStyle),D(e.select("path.line"),this.transitionDuration(),this.transitionDelay()).attr("stroke",(t,e)=>this._getColor(t,e)).attr("d",t=>this._safeD(i(t.values)))}_drawArea(t,e){if(this._renderArea){const i=d.area().x(t=>this.x()(t.x)).y1(t=>this.y()(t.y+t.y0)).y0(t=>this.y()(t.y0)).curve(this._getCurveFactory());this._defined&&i.defined(this._defined),t.append("path").attr("class","area").attr("fill",(t,e)=>this._getColor(t,e)).attr("d",t=>this._safeD(i(t.values))),D(e.select("path.area"),this.transitionDuration(),this.transitionDelay()).attr("fill",(t,e)=>this._getColor(t,e)).attr("d",t=>this._safeD(i(t.values)))}}_safeD(t){return!t||0<=t.indexOf("NaN")?"M0,0":t}_drawDots(t,e){if("always"===this.xyTipsOn()||!this.brushOn()&&!this.parentBrushOn()&&this.xyTipsOn()){var i=`${Ot}-list`;let n=t.select(`g.${i}`);n.empty()&&(n=t.append("g").attr("class",i)),e.each((e,t)=>{let i=e.values;this._defined&&(i=i.filter(this._defined));let s=n.select(`g.${Ot}._${t}`);s.empty()&&(s=n.append("g").attr("class",`${Ot} _${t}`)),this._createRefLines(s);const r=s.selectAll("circle.dot").data(i,H("x")),a=this,h=r.enter().append("circle").attr("class","dot").classed("dc-tabbable",this._keyboardAccessible).attr("cx",t=>M.safeNumber(this.x()(t.x))).attr("cy",t=>M.safeNumber(this.y()(t.y+t.y0))).attr("r",this._getDotRadius()).style("fill-opacity",this._dataPointFillOpacity).style("stroke-opacity",this._dataPointStrokeOpacity).attr("fill",this.getColor).attr("stroke",this.getColor).on("mousemove",function(){var t=T.select(this);a._showDot(t),a._showRefLines(t,s)}).on("mouseout",function(){var t=T.select(this);a._hideDot(t),a._hideRefLines(s)}).merge(r);this._keyboardAccessible&&this._svg.selectAll(".dc-tabbable").attr("tabindex",0).on("focus",function(){var t=T.select(this);a._showDot(t),a._showRefLines(t,s)}).on("blur",function(){var t=T.select(this);a._hideDot(t),a._hideRefLines(s)}),h.call(t=>this._doRenderTitle(t,e)),D(h,this.transitionDuration()).attr("cx",t=>M.safeNumber(this.x()(t.x))).attr("cy",t=>M.safeNumber(this.y()(t.y+t.y0))).attr("fill",this.getColor),r.exit().remove()})}}_drawLabels(t){const r=this;t.each(function(t,e){const i=T.select(this),s=i.selectAll("text.lineLabel").data(t.values,H("x"));t=s.enter().append("text").attr("class","lineLabel").attr("text-anchor","middle").merge(s);D(t,r.transitionDuration()).attr("x",t=>M.safeNumber(r.x()(t.x))).attr("y",t=>{t=r.y()(t.y+t.y0)-3;return M.safeNumber(t)}).text(t=>r.label()(t)),D(s.exit(),r.transitionDuration()).attr("height",0).remove()})}_createRefLines(t){const e=t.select("path.yRef").empty()?t.append("path").attr("class",Bt):t.select("path.yRef");e.style("display","none").attr("stroke-dasharray","5,5");const i=t.select("path.xRef").empty()?t.append("path").attr("class",$t):t.select("path.xRef");i.style("display","none").attr("stroke-dasharray","5,5")}_showDot(t){return t.style("fill-opacity",.8),t.style("stroke-opacity",.8),t.attr("r",this._dotRadius),t}_showRefLines(t,e){var i=t.attr("cx"),s=t.attr("cy"),t=`M${this._yAxisX()-this.margins().left} ${s}L${i} ${s}`,s=`M${i} ${this.yAxisHeight()}L${i} ${s}`;e.select("path.yRef").style("display","").attr("d",t),e.select("path.xRef").style("display","").attr("d",s)}_getDotRadius(){return this._dataPointRadius||this._dotRadius}_hideDot(t){t.style("fill-opacity",this._dataPointFillOpacity).style("stroke-opacity",this._dataPointStrokeOpacity).attr("r",this._getDotRadius())}_hideRefLines(t){t.select("path.yRef").style("display","none"),t.select("path.xRef").style("display","none")}_doRenderTitle(t,e){this.renderTitle()&&(t.select("title").remove(),t.append("title").text(H("data",this.title(e.name))))}xyTipsOn(t){return arguments.length?(this._xyTipsOn=t,this):this._xyTipsOn}dotRadius(t){return arguments.length?(this._dotRadius=t,this):this._dotRadius}renderDataPoints(t){return arguments.length?(t?(this._dataPointFillOpacity=t.fillOpacity||.8,this._dataPointStrokeOpacity=t.strokeOpacity||0,this._dataPointRadius=t.radius||2):(this._dataPointFillOpacity=1e-6,this._dataPointStrokeOpacity=1e-6,this._dataPointRadius=null),this):{fillOpacity:this._dataPointFillOpacity,strokeOpacity:this._dataPointStrokeOpacity,radius:this._dataPointRadius}}_colorFilter(i,s,r){return function(){const t=T.select(this);var e=t.attr("stroke")===i&&t.attr("stroke-dasharray")===(s instanceof Array?s.join(","):null)||t.attr("fill")===i;return r?!e:e}}legendHighlight(t){this.isLegendableHidden(t)||this.g().selectAll("path.line, path.area").classed("highlight",this._colorFilter(t.color,t.dashstyle)).classed("fadeout",this._colorFilter(t.color,t.dashstyle,!0))}legendReset(){this.g().selectAll("path.line, path.area").classed("highlight",!1).classed("fadeout",!1)}legendables(){const t=super.legendables();return this._dashStyle?t.map(t=>(t.dashstyle=this._dashStyle,t)):t}}const Pt=(t,e)=>new Ft(t,e),Ht="number-display";class Tt extends q{constructor(t,e){super(),this._formatNumber=i.format(".2s"),this._html={one:"",some:"",none:""},this._lastValue=void 0,this._ariaLiveRegion=!1,this._mandatoryAttributes(["group"]),this.ordering(t=>t.value),this.data(t=>{t=t.value?t.value():this._maxBin(t.all());return this.valueAccessor()(t)}),this.transitionDuration(250),this.transitionDelay(0),this.anchor(t,e)}html(t){return arguments.length?(t.none?this._html.none=t.none:t.one?this._html.none=t.one:t.some&&(this._html.none=t.some),t.one?this._html.one=t.one:t.some&&(this._html.one=t.some),t.some?this._html.some=t.some:t.one&&(this._html.some=t.one),this):this._html}value(){return this.data()}_maxBin(t){if(!t.length)return null;t=this._computeOrderedGroups(t);return t[t.length-1]}_doRender(){const r=this.value();let t=this.selectAll(`.${Ht}`);t.empty()&&(t=t.data([0]).enter().append("span").attr("class",Ht).classed("dc-tabbable",this._keyboardAccessible).merge(t),this._keyboardAccessible&&t.attr("tabindex","0"),this._ariaLiveRegion&&(this.transitionDuration(0),t.attr("aria-live","polite")));{const a=this;t.transition().duration(a.transitionDuration()).delay(a.transitionDelay()).ease(u.easeQuad).tween("text",function(){var t=isFinite(a._lastValue)?a._lastValue:0;const i=h.interpolateNumber(t||0,r);a._lastValue=r;const s=this;return t=>{let e=null;t=a.formatNumber()(i(t));0===r&&""!==a._html.none?e=a._html.none:1===r&&""!==a._html.one?e=a._html.one:""!==a._html.some&&(e=a._html.some),s.innerHTML=e?e.replace("%number",t):t}})}}_doRedraw(){return this._doRender()}formatNumber(t){return arguments.length?(this._formatNumber=t,this):this._formatNumber}ariaLiveRegion(t){return arguments.length?(this._ariaLiveRegion=t,this):this._ariaLiveRegion}}class Et extends Z(j(q)){constructor(t,e){super(),this._sliceCssClass="pie-slice",this._labelCssClass="pie-label",this._sliceGroupCssClass="pie-slice-group",this._labelGroupCssClass="pie-label-group",this._emptyCssClass="empty-chart",this._emptyTitle="empty",this._radius=void 0,this._givenRadius=void 0,this._innerRadius=0,this._externalRadiusPadding=0,this._g=void 0,this._cx=void 0,this._cy=void 0,this._minAngleForLabel=.5,this._externalLabelRadius=void 0,this._drawPaths=!1,this.colorAccessor(t=>this.cappedKeyAccessor(t)),this.title(t=>`${this.cappedKeyAccessor(t)}: ${this.cappedValueAccessor(t)}`),this.label(t=>this.cappedKeyAccessor(t)),this.renderLabel(!0),this.transitionDuration(350),this.transitionDelay(0),this.anchor(t,e)}slicesCap(t){return this.cap(t)}_doRender(){return this.resetSvg(),this._g=this.svg().append("g").attr("transform",`translate(${this.cx()},${this.cy()})`),this._g.append("g").attr("class",this._sliceGroupCssClass),this._g.append("g").attr("class",this._labelGroupCssClass),this._drawChart(),this}_drawChart(){var t=E.min([this.width(),this.height()])/2;this._radius=this._givenRadius&&this._givenRadius<t?this._givenRadius:t;var e,i=this._buildArcs();const s=this._pieLayout();let r;E.sum(this.data(),t=>this.cappedValueAccessor(t))?(r=s(this.data()),this._g.classed(this._emptyCssClass,!1)):(r=s([{key:this._emptyTitle,value:1,others:[this._emptyTitle]}]),this._g.classed(this._emptyCssClass,!0)),this._g&&(e=this._g.select(`g.${this._sliceGroupCssClass}`).selectAll(`g.${this._sliceCssClass}`).data(r),t=this._g.select(`g.${this._labelGroupCssClass}`).selectAll(`text.${this._labelCssClass}`).data(r),this._removeElements(e,t),this._createElements(e,t,i,r),this._updateElements(r,i),this._highlightFilter(),D(this._g,this.transitionDuration(),this.transitionDelay()).attr("transform",`translate(${this.cx()},${this.cy()})`))}_createElements(t,e,i,s){t=this._createSliceNodes(t);this._createSlicePath(t,i),this._createTitles(t),this._createLabels(e,s,i)}_createSliceNodes(t){return t.enter().append("g").attr("class",(t,e)=>`${this._sliceCssClass} _${e}`).classed("dc-tabbable",this._keyboardAccessible)}_createSlicePath(t,i){t=t.append("path").attr("fill",(t,e)=>this._fill(t,e)).on("click",C.eventHandler(t=>this._onClick(t))).attr("d",(t,e)=>this._safeArc(t,e,i));this._keyboardAccessible&&this._makeKeyboardAccessible(this._onClick);const e=D(t,this.transitionDuration(),this.transitionDelay());if(e.attrTween){const s=this;e.attrTween("d",function(t){return s._tweenPie(t,this)})}}_createTitles(t){this.renderTitle()&&t.append("title").text(t=>this.title()(t.data))}_applyLabelText(t){t.text(t=>{var e=t.data;return!this._sliceHasNoData(e)&&!this._sliceTooSmall(t)||this._isSelectedSlice(t)?this.label()(t.data):""})}_positionLabels(t,e){this._applyLabelText(t),D(t,this.transitionDuration(),this.transitionDelay()).attr("transform",t=>this._labelPosition(t,e)).attr("text-anchor","middle")}_highlightSlice(t,e){this.select(`g.pie-slice._${t}`).classed("highlight",e)}_createLabels(t,e,i){this.renderLabel()&&(t=t.enter().append("text").attr("class",(t,e)=>{let i=`${this._sliceCssClass} ${this._labelCssClass} _${e}`;return this._externalLabelRadius&&(i+=" external"),i}).on("click",C.eventHandler(t=>this._onClick(t))).on("mouseover",C.eventHandler(t=>{this._highlightSlice(t.index,!0)})).on("mouseout",C.eventHandler(t=>{this._highlightSlice(t.index,!1)})),this._positionLabels(t,i),this._externalLabelRadius&&this._drawPaths&&this._updateLabelPaths(e,i))}_updateLabelPaths(t,s){let e=this._g.selectAll(`polyline.${this._sliceCssClass}`).data(t);e.exit().remove(),e=e.enter().append("polyline").attr("class",(t,e)=>`pie-path _${e} ${this._sliceCssClass}`).on("click",C.eventHandler(t=>this._onClick(t))).on("mouseover",C.eventHandler(t=>{this._highlightSlice(t.index,!0)})).on("mouseout",C.eventHandler(t=>{this._highlightSlice(t.index,!1)})).merge(e);const r=d.arc().outerRadius(this._radius-this._externalRadiusPadding+this._externalLabelRadius).innerRadius(this._radius-this._externalRadiusPadding),i=D(e,this.transitionDuration(),this.transitionDelay());i.attrTween?i.attrTween("points",function(t){var e={startAngle:(e=this._current||t).startAngle,endAngle:e.endAngle};const i=h.interpolate(e,t);return this._current=i(0),t=>{t=i(t);return[s.centroid(t),r.centroid(t)]}}):i.attr("points",t=>[s.centroid(t),r.centroid(t)]),i.style("visibility",t=>t.endAngle-t.startAngle<1e-4?"hidden":"visible")}_updateElements(t,e){this._updateSlicePaths(t,e),this._updateLabels(t,e),this._updateTitles(t)}_updateSlicePaths(t,i){t=this._g.selectAll(`g.${this._sliceCssClass}`).data(t).select("path").attr("d",(t,e)=>this._safeArc(t,e,i));const e=D(t,this.transitionDuration(),this.transitionDelay());if(e.attrTween){const s=this;e.attrTween("d",function(t){return s._tweenPie(t,this)})}e.attr("fill",(t,e)=>this._fill(t,e))}_updateLabels(t,e){var i;this.renderLabel()&&(i=this._g.selectAll(`text.${this._labelCssClass}`).data(t),this._positionLabels(i,e),this._externalLabelRadius&&this._drawPaths&&this._updateLabelPaths(t,e))}_updateTitles(t){this.renderTitle()&&this._g.selectAll(`g.${this._sliceCssClass}`).data(t).select("title").text(t=>this.title()(t.data))}_removeElements(t,e){t.exit().remove(),e.exit().remove()}_highlightFilter(){const e=this;this.hasFilter()?this.selectAll(`g.${this._sliceCssClass}`).each(function(t){e._isSelectedSlice(t)?e.highlightSelected(this):e.fadeDeselected(this)}):this.selectAll(`g.${this._sliceCssClass}`).each(function(){e.resetHighlight(this)})}externalRadiusPadding(t){return arguments.length?(this._externalRadiusPadding=t,this):this._externalRadiusPadding}innerRadius(t){return arguments.length?(this._innerRadius=t,this):this._innerRadius}radius(t){return arguments.length?(this._givenRadius=t,this):this._givenRadius}cx(t){return arguments.length?(this._cx=t,this):this._cx||this.width()/2}cy(t){return arguments.length?(this._cy=t,this):this._cy||this.height()/2}_buildArcs(){return d.arc().outerRadius(this._radius-this._externalRadiusPadding).innerRadius(this._innerRadius)}_isSelectedSlice(t){return this.hasFilter(this.cappedKeyAccessor(t.data))}_doRedraw(){return this._drawChart(),this}minAngleForLabel(t){return arguments.length?(this._minAngleForLabel=t,this):this._minAngleForLabel}_pieLayout(){return d.pie().sort(null).value(t=>this.cappedValueAccessor(t))}_sliceTooSmall(t){t=t.endAngle-t.startAngle;return isNaN(t)||t<this._minAngleForLabel}_sliceHasNoData(t){return 0===this.cappedValueAccessor(t)}_isOffCanvas(t){return!t||isNaN(t.startAngle)||isNaN(t.endAngle)}_fill(t,e){return this.getColor(t.data,e)}_onClick(t){this._g.attr("class")!==this._emptyCssClass&&this.onClick(t.data)}_safeArc(t,e,i){let s=i(t,e);return 0<=s.indexOf("NaN")&&(s="M0,0"),s}emptyTitle(t){return 0===arguments.length?this._emptyTitle:(this._emptyTitle=t,this)}externalLabels(t){return 0===arguments.length?this._externalLabelRadius:(this._externalLabelRadius=t||void 0,this)}drawPaths(t){return 0===arguments.length?this._drawPaths:(this._drawPaths=t,this)}_labelPosition(t,e){let i;return i=(this._externalLabelRadius?d.arc().outerRadius(this._radius-this._externalRadiusPadding+this._externalLabelRadius).innerRadius(this._radius-this._externalRadiusPadding+this._externalLabelRadius):e).centroid(t),isNaN(i[0])||isNaN(i[1])?"translate(0,0)":`translate(${i})`}legendables(){return this.data().map((t,e)=>{const i={name:t.key,data:t.value,others:t.others,chart:this};return i.color=this.getColor(t,e),i})}legendHighlight(t){this._highlightSliceFromLegendable(t,!0)}legendReset(t){this._highlightSliceFromLegendable(t,!1)}legendToggle(t){this.onClick({key:t.name,others:t.others})}_highlightSliceFromLegendable(e,i){this.selectAll("g.pie-slice").each(function(t){e.name===t.data.key&&T.select(this).classed("highlight",i)})}_tweenPie(t,e){t.innerRadius=this._innerRadius;let i=e._current;i=this._isOffCanvas(i)?{startAngle:0,endAngle:0}:{startAngle:i.startAngle,endAngle:i.endAngle};const s=h.interpolate(i,t);return e._current=s(0),t=>this._safeArc(s(t),0,this._buildArcs())}}class zt extends Z(j(J)){constructor(t,e){super(),this._g=void 0,this._labelOffsetX=10,this._labelOffsetY=15,this._hasLabelOffsetY=!1,this._dyOffset="0.35em",this._titleLabelOffsetX=2,this._gap=5,this._fixedBarHeight=!1,this._rowCssClass="row",this._titleRowCssClass="titlerow",this._renderTitleLabel=!1,this._x=void 0,this._elasticX=void 0,this._xAxis=n.axisBottom(),this._rowData=void 0,this.rowsCap=this.cap,this.title(t=>`${this.cappedKeyAccessor(t)}: ${this.cappedValueAccessor(t)}`),this.label(t=>this.cappedKeyAccessor(t)),this.anchor(t,e)}_calculateAxisScale(){if(!this._x||this._elasticX){const t=E.extent(this._rowData,t=>this.cappedValueAccessor(t));0<t[0]&&(t[0]=0),t[1]<0&&(t[1]=0),this._x=z.scaleLinear().domain(t).range([0,this.effectiveWidth()])}this._xAxis.scale(this._x)}_drawAxis(){let t=this._g.select("g.axis");this._calculateAxisScale(),t.empty()&&(t=this._g.append("g").attr("class","axis")),t.attr("transform",`translate(0, ${this.effectiveHeight()})`),D(t,this.transitionDuration(),this.transitionDelay()).call(this._xAxis)}_doRender(){return this.resetSvg(),this._g=this.svg().append("g").attr("transform",`translate(${this.margins().left},${this.margins().top})`),this._drawChart(),this}x(t){return arguments.length?(this._x=t,this):this._x}_drawGridLines(){this._g.selectAll("g.tick").select("line.grid-line").remove(),this._g.selectAll("g.tick").append("line").attr("class","grid-line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",()=>-this.effectiveHeight())}_drawChart(){this._rowData=this.data(),this._drawAxis(),this._drawGridLines();var t=this._g.selectAll(`g.${this._rowCssClass}`).data(this._rowData);this._removeElements(t),t=this._createElements(t).merge(t),this._updateElements(t)}_createElements(t){const e=t.enter().append("g").attr("class",(t,e)=>`${this._rowCssClass} _${e}`);return e.append("rect").attr("width",0),this._createLabels(e),e}_removeElements(t){t.exit().remove()}_rootValue(){var t=this._x(0);return t===-1/0||t!=t?this._x(1):t}_updateElements(t){var e=this._rowData.length;let i;i=this._fixedBarHeight||(this.effectiveHeight()-(e+1)*this._gap)/e,this._hasLabelOffsetY||(this._labelOffsetY=i/2);e=t.attr("transform",(t,e)=>`translate(0,${(e+1)*this._gap+e*i})`).select("rect").attr("height",i).attr("fill",this.getColor).on("click",C.eventHandler(t=>this._onClick(t))).classed("dc-tabbable",this._keyboardAccessible).classed("deselected",t=>!!this.hasFilter()&&!this._isSelectedRow(t)).classed("selected",t=>!!this.hasFilter()&&this._isSelectedRow(t));this._keyboardAccessible&&this._makeKeyboardAccessible(t=>this._onClick(t)),D(e,this.transitionDuration(),this.transitionDelay()).attr("width",t=>Math.abs(this._rootValue()-this._x(this.cappedValueAccessor(t)))).attr("transform",t=>this._translateX(t)),this._createTitles(t),this._updateLabels(t)}_createTitles(t){this.renderTitle()&&(t.select("title").remove(),t.append("title").text(this.title()))}_createLabels(t){this.renderLabel()&&t.append("text").on("click",C.eventHandler(t=>this._onClick(t))),this.renderTitleLabel()&&t.append("text").attr("class",this._titleRowCssClass).on("click",C.eventHandler(t=>this._onClick(t)))}_updateLabels(t){var e;this.renderLabel()&&(e=t.select("text").attr("x",this._labelOffsetX).attr("y",this._labelOffsetY).attr("dy",this._dyOffset).on("click",C.eventHandler(t=>this._onClick(t))).attr("class",(t,e)=>`${this._rowCssClass} _${e}`).text(t=>this.label()(t)),D(e,this.transitionDuration(),this.transitionDelay()).attr("transform",t=>this._translateX(t))),this.renderTitleLabel()&&(t=t.select(`.${this._titleRowCssClass}`).attr("x",this.effectiveWidth()-this._titleLabelOffsetX).attr("y",this._labelOffsetY).attr("dy",this._dyOffset).attr("text-anchor","end").on("click",C.eventHandler(t=>this._onClick(t))).attr("class",(t,e)=>`${this._titleRowCssClass} _${e}`).text(t=>this.title()(t)),D(t,this.transitionDuration(),this.transitionDelay()).attr("transform",t=>this._translateX(t)))}renderTitleLabel(t){return arguments.length?(this._renderTitleLabel=t,this):this._renderTitleLabel}_onClick(t){this.onClick(t)}_translateX(t){var e=this._x(this.cappedValueAccessor(t)),t=this._rootValue();return`translate(${t<e?t:e},0)`}_doRedraw(){return this._drawChart(),this}xAxis(t){return arguments.length?(this._xAxis=t,this):this._xAxis}fixedBarHeight(t){return arguments.length?(this._fixedBarHeight=t,this):this._fixedBarHeight}gap(t){return arguments.length?(this._gap=t,this):this._gap}elasticX(t){return arguments.length?(this._elasticX=t,this):this._elasticX}labelOffsetX(t){return arguments.length?(this._labelOffsetX=t,this):this._labelOffsetX}labelOffsetY(t){return arguments.length?(this._labelOffsetY=t,this._hasLabelOffsetY=!0,this):this._labelOffsetY}titleLabelOffsetX(t){return arguments.length?(this._titleLabelOffsetX=t,this):this._titleLabelOffsetX}_isSelectedRow(t){return this.hasFilter(this.cappedKeyAccessor(t))}}class Mt extends at{constructor(t,e){super(),this._symbol=d.symbol(),this._existenceAccessor=t=>t.value;const i=this.keyAccessor();this.keyAccessor(t=>i(t)[0]),this.valueAccessor(t=>i(t)[1]),this.colorAccessor(()=>this._groupName),this.title(t=>`${this.keyAccessor()(t)},${this.valueAccessor()(t)}: ${this.existenceAccessor()(t)}`),this._highlightedSize=7,this._symbolSize=5,this._excludedSize=3,this._excludedColor=null,this._excludedOpacity=1,this._emptySize=0,this._emptyOpacity=0,this._nonemptyOpacity=1,this._emptyColor=null,this._filtered=[],this._canvas=null,this._context=null,this._useCanvas=!1,this.brush(o.brush()),this._symbol.size((t,e)=>this._elementSize(t,e)),this.anchor(t,e)}_canvasElementSize(t,e){return this._existenceAccessor(t)?e?this._symbolSize/Math.sqrt(Math.PI):this._excludedSize/Math.sqrt(Math.PI):this._emptySize/Math.sqrt(Math.PI)}_elementSize(t,e){return this._existenceAccessor(t)?this._filtered[e]?Math.pow(this._symbolSize,2):Math.pow(this._excludedSize,2):Math.pow(this._emptySize,2)}_locator(t){return`translate(${this.x()(this.keyAccessor()(t))},${this.y()(this.valueAccessor()(t))})`}filter(t){return arguments.length?super.filter(F.RangedTwoDimensionalFilter(t)):super.filter()}resetSvg(){if(this._useCanvas){super.resetSvg(),this.select("canvas").remove();const h=this.svg(),n=this.root();n.style("position","relative"),h.style("position","relative");var t=isNaN(parseInt(h.style("left"),10))?0:parseInt(h.style("left"),10),e=isNaN(parseInt(h.style("top"),10))?0:parseInt(h.style("top"),10),i=this.effectiveWidth(),s=this.effectiveHeight(),r=this.margins(),a=window.devicePixelRatio||1;return this._canvas=this.root().append("canvas").attr("x",0).attr("y",0).attr("width",i*a).attr("height",s*a).style("width",`${i}px`).style("height",`${s}px`).style("position","absolute").style("top",`${r.top+e}px`).style("left",`${r.left+t}px`).style("z-index",-1).style("pointer-events","none"),this._context=this._canvas.node().getContext("2d"),this._context.scale(a,a),this._context.rect(0,0,i,s),this._context.clip(),this._context.imageSmoothingQuality="high",this.svg()}return super.resetSvg()}_resizeCanvas(){var t=this.effectiveWidth(),e=this.effectiveHeight(),i=window.devicePixelRatio||1;this._canvas.attr("width",t*i).attr("height",e*i).style("width",`${t}px`).style("height",`${e}px`),this._context.scale(i,i)}useCanvas(t){return arguments.length?(this._useCanvas=t,this):this._useCanvas}canvas(t){return arguments.length?(this._canvas=t,this):this._canvas}context(){return this._context}_plotOnCanvas(h){this._resizeCanvas();const n=this.context();n.clearRect(0,0,+(n.canvas.width+2),+(n.canvas.height+2));const t=this.data();t.forEach((t,e)=>{var i=!this.filter()||this.filter().isFiltered([t.key[0],t.key[1]]);let s=1;s=this._existenceAccessor(t)?i?this._nonemptyOpacity:this.excludedOpacity():this._emptyOpacity;let r=null;r=this._emptyColor&&!this._existenceAccessor(t)?this._emptyColor:this.excludedColor()&&!i?this.excludedColor():this.getColor(t);let a=this._canvasElementSize(t,i);h&&((i=r===h.color)||(s=.1),i&&(a=this._highlightedSize/Math.sqrt(Math.PI))),n.save(),n.globalAlpha=s,n.beginPath(),n.arc(this.x()(this.keyAccessor()(t)),this.y()(this.valueAccessor()(t)),a,0,2*Math.PI,!0),n.fillStyle=r,n.fill(),n.restore()})}_plotOnSVG(){const e=this.data();this._keyboardAccessible&&e.sort((t,e)=>E.ascending(this.keyAccessor()(t),this.keyAccessor()(e)));let t=this.chartBodyG().selectAll("path.symbol").data(e);D(t.exit(),this.transitionDuration(),this.transitionDelay()).attr("opacity",0).remove(),t=t.enter().append("path").attr("class","symbol").classed("dc-tabbable",this._keyboardAccessible).attr("opacity",0).attr("fill",this.getColor).attr("transform",t=>this._locator(t)).merge(t),this._keyboardAccessible&&(this._makeKeyboardAccessible(),t.order()),t.call(t=>this._renderTitles(t,e)),t.each((t,e)=>{this._filtered[e]=!this.filter()||this.filter().isFiltered([this.keyAccessor()(t),this.valueAccessor()(t)])}),D(t,this.transitionDuration(),this.transitionDelay()).attr("opacity",(t,e)=>this._existenceAccessor(t)?this._filtered[e]?this._nonemptyOpacity:this.excludedOpacity():this._emptyOpacity).attr("fill",(t,e)=>this._emptyColor&&!this._existenceAccessor(t)?this._emptyColor:this.excludedColor()&&!this._filtered[e]?this.excludedColor():this.getColor(t)).attr("transform",t=>this._locator(t)).attr("d",this._symbol)}plotData(){this._useCanvas?this._plotOnCanvas():this._plotOnSVG()}_renderTitles(t,e){this.renderTitle()&&(t.selectAll("title").remove(),t.append("title").text(t=>this.title()(t)))}existenceAccessor(t){return arguments.length?(this._existenceAccessor=t,this):this._existenceAccessor}symbol(t){return arguments.length?(this._symbol.type(t),this):this._symbol.type()}customSymbol(t){return arguments.length?(this._symbol=t,this._symbol.size((t,e)=>this._elementSize(t,e)),this):this._symbol}symbolSize(t){return arguments.length?(this._symbolSize=t,this):this._symbolSize}highlightedSize(t){return arguments.length?(this._highlightedSize=t,this):this._highlightedSize}excludedSize(t){return arguments.length?(this._excludedSize=t,this):this._excludedSize}excludedColor(t){return arguments.length?(this._excludedColor=t,this):this._excludedColor}excludedOpacity(t){return arguments.length?(this._excludedOpacity=t,this):this._excludedOpacity}emptySize(t){return arguments.length?(this._emptySize=t,this):this._emptySize}hiddenSize(t){return arguments.length?this.emptySize(t):this.emptySize()}emptyColor(t){return arguments.length?(this._emptyColor=t,this):this._emptyColor}emptyOpacity(t){return arguments.length?(this._emptyOpacity=t,this):this._emptyOpacity}nonemptyOpacity(t){return arguments.length?(this._nonemptyOpacity=t,this):this._emptyOpacity}legendables(){return[{chart:this,name:this._groupName,color:this.getColor()}]}legendHighlight(e){this._useCanvas?this._plotOnCanvas(e):(this._resizeSymbolsWhere(t=>t.attr("fill")===e.color,this._highlightedSize),this.chartBodyG().selectAll(".chart-body path.symbol").filter(function(){return T.select(this).attr("fill")!==e.color}).classed("fadeout",!0))}legendReset(e){this._useCanvas?this._plotOnCanvas(e):(this._resizeSymbolsWhere(t=>t.attr("fill")===e.color,this._symbolSize),this.chartBodyG().selectAll(".chart-body path.symbol").filter(function(){return T.select(this).attr("fill")!==e.color}).classed("fadeout",!1))}_resizeSymbolsWhere(t,e){var i=this.chartBodyG().selectAll(".chart-body path.symbol").filter(function(){return t(T.select(this))}),s=this._symbol.size();this._symbol.size(Math.pow(e,2)),D(i,this.transitionDuration(),this.transitionDelay()).attr("d",this._symbol),this._symbol.size(s)}createBrushHandlePaths(){}extendBrush(t){return this.round()&&(t[0]=t[0].map(this.round()),t[1]=t[1].map(this.round())),t}brushIsEmpty(t){return!t||t[0][0]>=t[1][0]||t[0][1]>=t[1][1]}_brushing(i){if(!this._ignoreBrushEvents){let t=i.selection,e=this.brushIsEmpty(t);t&&(t=t.map(t=>t.map((t,e)=>{const i=0===e?this.x():this.y();return i.invert(t)})),t=this.extendBrush(t),e=e&&this.brushIsEmpty(t)),this.redrawBrush(t,!1);const s=e?null:F.RangedTwoDimensionalFilter(t);$.trigger(()=>{this.replaceFilter(s),this.redrawGroup()},x.EVENT_DELAY)}}redrawBrush(t,e){if(this._gBrush=this.gBrush(),this.brushOn()&&this._gBrush)if(this.resizing()&&this.setBrushExtents(e),t){t=t.map(t=>t.map((t,e)=>{const i=0===e?this.x():this.y();return i(t)}));const i=O(e,this.transitionDuration(),this.transitionDelay())(this._gBrush);this._withoutBrushEvents(()=>{i.call(this.brush().move,t)})}else this._withoutBrushEvents(()=>{this._gBrush.call(this.brush().move,t)});this.fadeDeselectedArea(t)}}const Nt="dc-select-option";class Gt extends q{constructor(t,e){super(),this._select=void 0,this._promptText="Select all",this._multiple=!1,this._promptValue=null,this._numberVisible=null,this.data(t=>t.all().filter(this._filterDisplayed)),this._filterDisplayed=t=>0<this.valueAccessor()(t),this._order=(t,e)=>this.keyAccessor()(t)>this.keyAccessor()(e)?1:this.keyAccessor()(t)<this.keyAccessor()(e)?-1:0,this.anchor(t,e)}_doRender(){return this.select("select").remove(),this._select=this.root().append("select").classed("dc-select-menu",!0),this._select.append("option").text(this._promptText).attr("value",""),this._doRedraw(),this}_doRedraw(){return this._setAttributes(),this._renderOptions(),this.hasFilter()&&this._multiple?this._select.selectAll("option").property("selected",t=>void 0!==t&&0<=this.filters().indexOf(String(this.keyAccessor()(t)))):this.hasFilter()?this._select.property("value",this.filter()):this._select.property("value",""),this}_renderOptions(){const t=this._select.selectAll(`option.${Nt}`).data(this.data(),t=>this.keyAccessor()(t));t.exit().remove(),t.enter().append("option").classed(Nt,!0).attr("value",t=>this.keyAccessor()(t)).merge(t).text(this.title()),this._select.selectAll(`option.${Nt}`).sort(this._order),this._select.on("change",C.eventHandler((t,e)=>this._onChange(t,e)))}_onChange(t,e){let i;var s=e.target;if(s.selectedOptions){const r=Array.prototype.slice.call(s.selectedOptions);i=r.map(t=>t.value)}else{const a=[].slice.call(e.target.options);i=a.filter(t=>t.selected).map(t=>t.value)}1===i.length&&""===i[0]?i=this._promptValue||null:this._multiple||1!==i.length||(i=i[0]),this.onChange(i)}onChange(t){t&&this._multiple?this.replaceFilter([t]):t?this.replaceFilter(t):this.filterAll(),$.trigger(()=>{this.redrawGroup()})}_setAttributes(){this._multiple?this._select.attr("multiple",!0):this._select.attr("multiple",null),null!==this._numberVisible?this._select.attr("size",this._numberVisible):this._select.attr("size",null)}order(t){return arguments.length?(this._order=t,this):this._order}promptText(t){return arguments.length?(this._promptText=t,this):this._promptText}filterDisplayed(t){return arguments.length?(this._filterDisplayed=t,this):this._filterDisplayed}multiple(t){return arguments.length?(this._multiple=t,this):this._multiple}promptValue(t){return arguments.length?(this._promptValue=t,this):this._promptValue}numberVisible(t){return arguments.length?(this._numberVisible=t,this):this._numberVisible}size(t){return b.warnOnce("selectMenu.size is ambiguous - use selectMenu.numberVisible instead"),arguments.length?this.numberVisible(t):this.numberVisible()}}class Yt extends ft{constructor(t,e){super(t,e),this._keySort=(t,e)=>E.ascending(this.keyAccessor()(t),this.keyAccessor()(e)),this._charts={},this._chartFunction=Pt,this._chartGroup=e,this._seriesAccessor=void 0,this._seriesSort=E.ascending,this._valueSort=this._keySort,this._mandatoryAttributes().push("seriesAccessor","chart"),this.shareColors(!0)}_compose(t){super.compose(t)}compose(t){throw new Error("Not supported for this chart type")}_preprocessData(){const s=[];let r;const t=C.nester({key:this._seriesAccessor,sortKeys:this._seriesSort,sortValues:this._valueSort,entries:this.data()});var e=t.map((t,e)=>{const i=this._charts[t.key]||this._chartFunction(this,this._chartGroup,t.key,e);return this._charts[t.key]||(r=!0),this._charts[t.key]=i,s.push(t.key),i.dimension(this.dimension()).group({all:"function"==typeof t.values?t.values:M.constant(t.values)},t.key).keyAccessor(this.keyAccessor()).valueAccessor(this.valueAccessor()).brushOn(!1)});Object.keys(this._charts).filter(t=>-1===s.indexOf(t)).forEach(t=>{this._clearChart(t),r=!0}),this._compose(e),r&&this.legend()&&this.legend().render()}_clearChart(t){this._charts[t].g()&&this._charts[t].g().remove(),delete this._charts[t]}_resetChildren(){Object.keys(this._charts).map(this._clearChart.bind(this)),this._charts={}}chart(t){return arguments.length?(this._chartFunction=t,this._resetChildren(),this):this._chartFunction}seriesAccessor(t){return arguments.length?(this._seriesAccessor=t,this._resetChildren(),this):this._seriesAccessor}seriesSort(t){return arguments.length?(this._seriesSort=t,this._resetChildren(),this):this._seriesSort}valueSort(t){return arguments.length?(this._valueSort=t,this._resetChildren(),this):this._valueSort}}class Vt extends j(q){constructor(t,e){super(),this._sliceCssClass="pie-slice",this._emptyCssClass="empty-chart",this._emptyTitle="empty",this._radius=void 0,this._givenRadius=void 0,this._innerRadius=0,this._ringSizes=null,this._g=void 0,this._cx=void 0,this._cy=void 0,this._minAngleForLabel=.5,this._externalLabelRadius=void 0,this.colorAccessor(t=>this.keyAccessor()(t)),this.ordering(H("key")),this.title(t=>`${this.keyAccessor()(t)}: ${this._extendedValueAccessor(t)}`),this.label(t=>this.keyAccessor()(t)),this.renderLabel(!0),this.transitionDuration(350),this.anchor(t,e)}_extendedValueAccessor(t){return t.path?t.value:this.valueAccessor()(t)}_scaleRadius(t,e){if(0===t)return this._innerRadius;var i=E.sum(this.ringSizes().relativeRingSizes.slice(0,t)),i=t*(1/this.ringSizes().relativeRingSizes.length)/i,e=(e-this.ringSizes().rootOffset)/(1-this.ringSizes().rootOffset)*(this._radius-this._innerRadius);return this._innerRadius+e/i}_doRender(){return this.resetSvg(),this._g=this.svg().append("g").attr("transform",`translate(${this.cx()},${this.cy()})`),this._drawChart(),this}_drawChart(){var t=E.min([this.width(),this.height()])/2;this._radius=this._givenRadius&&this._givenRadius<t?this._givenRadius:t;var e=this._buildArcs();let i,s;E.sum(this.data(),this.valueAccessor())?(s=M.toHierarchy(this.data(),this.valueAccessor()),i=this._partitionNodes(s),i.nodes.shift(),this._g.classed(this._emptyCssClass,!1)):(s=M.toHierarchy([],t=>t.value),i=this._partitionNodes(s),this._g.classed(this._emptyCssClass,!0)),this.ringSizes().rootOffset=i.rootOffset,this.ringSizes().relativeRingSizes=i.relativeRingSizes,this._g&&(t=this._g.selectAll(`g.${this._sliceCssClass}`).data(i.nodes),this._createElements(t,e,i.nodes),this._updateElements(i.nodes,e),this._removeElements(t),this._highlightFilter(),D(this._g,this.transitionDuration(),this.transitionDelay()).attr("transform",`translate(${this.cx()},${this.cy()})`))}_createElements(t,e,i){t=this._createSliceNodes(t);this._createSlicePath(t,e),this._createTitles(t),this._createLabels(i,e)}_createSliceNodes(t){return t.enter().append("g").attr("class",(t,e)=>`${this._sliceCssClass} _${e} ${this._sliceCssClass}-level-${t.depth}`)}_createSlicePath(t,e){t=t.append("path").attr("fill",(t,e)=>this._fill(t,e)).on("click",C.eventHandler(t=>this.onClick(t))).classed("dc-tabbable",this._keyboardAccessible).attr("d",t=>this._safeArc(e,t));this._keyboardAccessible&&this._makeKeyboardAccessible(this.onClick);const i=D(t,this.transitionDuration());if(i.attrTween){const s=this;i.attrTween("d",function(t){return s._tweenSlice(t,this)})}}_createTitles(t){this.renderTitle()&&t.append("title").text(t=>this.title()(t))}_positionLabels(t,e){D(t,this.transitionDuration()).attr("transform",t=>this._labelPosition(t,e)).attr("text-anchor","middle").text(t=>this._sliceHasNoData(t)||this._sliceTooSmall(t)?"":this.label()(t))}_createLabels(t,e){if(this.renderLabel()){const i=this._g.selectAll(`text.${this._sliceCssClass}`).data(t);i.exit().remove();t=i.enter().append("text").attr("class",(t,e)=>{let i=`${this._sliceCssClass} _${e}`;return this._externalLabelRadius&&(i+=" external"),i}).on("click",C.eventHandler(t=>this.onClick(t)));this._positionLabels(t,e)}}_updateElements(t,e){this._updateSlicePaths(t,e),this._updateLabels(t,e),this._updateTitles(t)}_updateSlicePaths(t,i){t=this._g.selectAll(`g.${this._sliceCssClass}`).data(t).select("path").attr("d",(t,e)=>this._safeArc(i,t));const e=D(t,this.transitionDuration());if(e.attrTween){const s=this;e.attrTween("d",function(t){return s._tweenSlice(t,this)})}e.attr("fill",(t,e)=>this._fill(t,e))}_updateLabels(t,e){this.renderLabel()&&(t=this._g.selectAll(`text.${this._sliceCssClass}`).data(t),this._positionLabels(t,e))}_updateTitles(t){this.renderTitle()&&this._g.selectAll(`g.${this._sliceCssClass}`).data(t).select("title").text(t=>this.title()(t))}_removeElements(t){t.exit().remove()}_highlightFilter(){const e=this;e.hasFilter()?e.selectAll(`g.${e._sliceCssClass}`).each(function(t){e._isSelectedSlice(t)?e.highlightSelected(this):e.fadeDeselected(this)}):e.selectAll(`g.${e._sliceCssClass}`).each(function(t){e.resetHighlight(this)})}innerRadius(t){return arguments.length?(this._innerRadius=t,this):this._innerRadius}radius(t){return arguments.length?(this._givenRadius=t,this):this._givenRadius}cx(t){return arguments.length?(this._cx=t,this):this._cx||this.width()/2}cy(t){return arguments.length?(this._cy=t,this):this._cy||this.height()/2}minAngleForLabel(t){return arguments.length?(this._minAngleForLabel=t,this):this._minAngleForLabel}emptyTitle(t){return 0===arguments.length?this._emptyTitle:(this._emptyTitle=t,this)}externalLabels(t){return 0===arguments.length?this._externalLabelRadius:(this._externalLabelRadius=t||void 0,this)}defaultRingSizes(){return{partitionDy:()=>this._radius*this._radius,scaleInnerRadius:t=>t.data.path&&1===t.data.path.length?this._innerRadius:Math.sqrt(t.y0),scaleOuterRadius:t=>Math.sqrt(t.y1),relativeRingSizesFunction:()=>[]}}equalRingSizes(){return this.relativeRingSizes(e=>{const i=[];for(let t=0;t<e;t++)i.push(1/e);return i})}relativeRingSizes(i){return{partitionDy:()=>1,scaleInnerRadius:t=>this._scaleRadius(t.data.path.length-1,t.y0),scaleOuterRadius:t=>this._scaleRadius(t.data.path.length,t.y1),relativeRingSizesFunction:t=>{var e=i(t);return function(t,e){if(!Array.isArray(t))throw new m("relativeRingSizes function must return an array");var i=E.sum(t);if(Math.abs(i-1)>x.NEGLIGIBLE_NUMBER)throw new m(`relativeRingSizes : portions must add up to 1, but sum was ${i}`);if(t.length!==e)throw new m(`relativeRingSizes : number of values must match number of rings (${e}) but was ${t.length}`)}(e,t),e}}}ringSizes(t){return arguments.length?(this._ringSizes=t,this):(this._ringSizes||(this._ringSizes=this.defaultRingSizes()),this._ringSizes)}_buildArcs(){return d.arc().startAngle(t=>t.x0).endAngle(t=>t.x1).innerRadius(t=>this.ringSizes().scaleInnerRadius(t)).outerRadius(t=>this.ringSizes().scaleOuterRadius(t))}_isSelectedSlice(t){return this._isPathFiltered(t.path)}_isPathFiltered(e){for(let t=0;t<this.filters().length;t++){const i=this.filters()[t];if(i.isFiltered(e))return!0}return!1}_filtersForPath(e){const i=F.HierarchyFilter(e),s=[];for(let t=0;t<this.filters().length;t++){const r=this.filters()[t];(r.isFiltered(e)||i.isFiltered(r))&&s.push(r)}return s}_doRedraw(){return this._drawChart(),this}_partitionNodes(t){function i(t){return{key:t.data.key,value:t.value}}const e=g.hierarchy(t).sum(t=>t.children?0:this._extendedValueAccessor(t)).sort((t,e)=>E.ascending(this.ordering()(i(t)),this.ordering()(i(e)))),s=g.partition().size([2*Math.PI,this.ringSizes().partitionDy()]);s(e);var r=e.descendants().map(t=>(t.key=t.data.key,t.path=t.data.path,t)),t=this.ringSizes().relativeRingSizesFunction(e.height);return{nodes:r,rootOffset:e.y1,relativeRingSizes:t}}_sliceTooSmall(t){t=t.x1-t.x0;return isNaN(t)||t<this._minAngleForLabel}_sliceHasNoData(t){return 0===this._extendedValueAccessor(t)}_isOffCanvas(t){return!t||isNaN(t.x0)||isNaN(t.y0)}_fill(t,e){return this.getColor(t.data,e)}onClick(t){if(this._g.attr("class")!==this._emptyCssClass){var i=t.path||t.key;const a=F.HierarchyFilter(i);var s=this._filtersForPath(i);let e=!1;for(let t=s.length-1;0<=t;t--){var r=s[t];M.arraysIdentical(r,i)&&(e=!0),this.filter(s[t])}$.trigger(()=>{e||this.filter(a),this.redrawGroup()})}}_safeArc(t,e){let i=t(e);return 0<=i.indexOf("NaN")&&(i="M0,0"),i}_labelPosition(t,e){let i;return i=(this._externalLabelRadius?d.arc().outerRadius(this._radius+this._externalLabelRadius).innerRadius(this._radius+this._externalLabelRadius):e).centroid(t),isNaN(i[0])||isNaN(i[1])?"translate(0,0)":`translate(${i})`}legendables(){return this.data().map((t,e)=>{const i={name:t.key,data:t.value,others:t.others,chart:this};return i.color=this.getColor(t,e),i})}legendHighlight(t){this._highlightSliceFromLegendable(t,!0)}legendReset(t){this._highlightSliceFromLegendable(t,!1)}legendToggle(t){this.onClick({key:t.name,others:t.others})}_highlightSliceFromLegendable(e,i){this.selectAll("g.pie-slice").each(function(t){e.name===t.key&&T.select(this).classed("highlight",i)})}_tweenSlice(e,t){let i=t._current;this._isOffCanvas(i)&&(i={x0:0,x1:0,y0:0,y1:0});var s={x0:e.x0,x1:e.x1,y0:e.y0,y1:e.y1};const r=h.interpolate(i,s);return t._current=r(0),t=>this._safeArc(this._buildArcs(),Object.assign({},e,r(t)))}}class It extends q{constructor(t,e){super(),this._normalize=t=>t.toLowerCase(),this._filterFunctionFactory=e=>(e=this._normalize(e),t=>-1!==this._normalize(t).indexOf(e)),this._placeHolder="search",this.group(()=>{throw"the group function on textFilterWidget should never be called, please report the issue"}),this.anchor(t,e)}_doRender(){this.select("input").remove(),this._input=this.root().append("input").classed("dc-text-filter-input",!0);const t=this;return this._input.on("input",function(){t.dimension().filterFunction(t._filterFunctionFactory(this.value)),$.trigger(()=>{t.redrawGroup()},x.EVENT_DELAY)}),this._doRedraw(),this}_doRedraw(){return this.root().selectAll("input").attr("placeholder",this._placeHolder),this}normalize(t){return arguments.length?(this._normalize=t,this):this._normalize}placeHolder(t){return arguments.length?(this._placeHolder=t,this):this._placeHolder}filterFunctionFactory(t){return arguments.length?(this._filterFunctionFactory=t,this):this._filterFunctionFactory}}+p.version[0]<6&&Object.assign(C,{eventHandler:i=>function(t,e){i.call(this,t,T.event)},callHandler:function(t,e,i,s){t.call(e,s)},nester:({key:t,sortKeys:e,sortValues:i,entries:s})=>{const r=y.nest().key(t);return e&&r.sortKeys(e),i&&r.sortValues(i),r.entries(s)},pointer:(t,e)=>T.mouse(e)}),5<+p.version[0]&&Object.assign(C,{eventHandler:i=>function(t,e){i.call(this,e,t)},callHandler:function(t,e,i,s){t.call(e,i,s)},nester:({key:t,sortKeys:e,sortValues:i,entries:s})=>{i&&(s=[...s].sort(i));let r=E.groups(s,t);return e&&(r=r.sort(e)),r.map(t=>({key:`${t[0]}`,values:t[1]}))},pointer:T.pointer}),t.BadArgumentException=m,t.BarChart=ct,t.BaseMixin=q,t.BoxPlot=_t,t.BubbleChart=ut,t.BubbleMixin=K,t.BubbleOverlay=yt,t.CapMixin=Z,t.CboxMenu=xt,t.ColorMixin=j,t.CompositeChart=ft,t.Config=A,t.CoordinateGridMixin=at,t.DataCount=bt,t.DataGrid=Ct,t.DataTable=St,t.GeoChoroplethChart=wt,t.HeatMap=Lt,t.HtmlLegend=Rt,t.InvalidStateException=P,t.Legend=Dt,t.LineChart=Ft,t.Logger=f,t.MarginMixin=J,t.NumberDisplay=Tt,t.PieChart=Et,t.RowChart=zt,t.ScatterPlot=Mt,t.SelectMenu=Gt,t.SeriesChart=Yt,t.StackMixin=ot,t.SunburstChart=Vt,t.TextFilterWidget=It,t.afterTransition=function(e,i){if(e.empty()||!e.duration)i.call(e);else{let t=0;e.each(()=>{++t}).on("end",()=>{--t||i.call(e)})}},t.barChart=(t,e)=>new ct(t,e),t.baseMixin=()=>new q,t.boxPlot=(t,e)=>new _t(t,e),t.bubbleChart=(t,e)=>new ut(t,e),t.bubbleOverlay=(t,e)=>new yt(t,e),t.cboxMenu=(t,e)=>new xt(t,e),t.chartRegistry=w,t.compositeChart=(t,e)=>new ft(t,e),t.config=v,t.constants=x,t.d3Box=ht,t.d3compat=C,t.dataCount=(t,e)=>new bt(t,e),t.dataGrid=(t,e)=>new Ct(t,e),t.dataTable=(t,e)=>new St(t,e),t.deregisterAllCharts=function(t){w.clear(t)},t.deregisterChart=S,t.events=$,t.filterAll=function(t){const e=w.list(t);for(let t=0;t<e.length;++t)e[t].filterAll()},t.filters=F,t.geoChoroplethChart=(t,e)=>new wt(t,e),t.hasChart=function(t){return w.has(t)},t.heatMap=(t,e)=>new Lt(t,e),t.htmlLegend=()=>new Rt,t.instanceOfChart=B,t.legend=()=>new Dt,t.lineChart=Pt,t.logger=b,t.numberDisplay=(t,e)=>new Tt(t,e),t.optionalTransition=O,t.pieChart=(t,e)=>new Et(t,e),t.pluck=H,t.printers=G,t.redrawAll=R,t.refocusAll=function(t){const e=w.list(t);for(let t=0;t<e.length;++t)e[t].focus&&e[t].focus()},t.registerChart=k,t.renderAll=L,t.renderlet=function(t){return arguments.length?(v._renderlet=t,null):v._renderlet},t.rowChart=(t,e)=>new zt(t,e),t.scatterPlot=(t,e)=>new Mt(t,e),t.selectMenu=(t,e)=>new Gt(t,e),t.seriesChart=(t,e)=>new Yt(t,e),t.sunburstChart=(t,e)=>new Vt(t,e),t.textFilterWidget=(t,e)=>new It(t,e),t.transition=D,t.units=Y,t.utils=M,t.version="4.2.7",Object.defineProperty(t,"__esModule",{value:!0})});