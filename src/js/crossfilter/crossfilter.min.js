!function(r,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(r=r||self).crossfilter=n()}(this,function(){"use strict";let o=r,t,u,f=n,i=e;function r(r){for(var n=new Array(r),e=-1;++e<r;)n[e]=0;return n}function n(r,n){for(var e=r.length;e<n;)r[e++]=0;return r}function e(r,n){if(32<n)throw new Error("invalid array width!");return r}function a(r){this.length=r,this.subarrays=1,this.width=8,this.masks={0:0},this[0]=o(r)}"undefined"!=typeof Uint8Array&&(o=function(r){return new Uint8Array(r)},t=function(r){return new Uint16Array(r)},u=function(r){return new Uint32Array(r)},f=function(r,n){if(r.length>=n)return r;n=new r.constructor(n);return n.set(r),n},i=function(r,n){var e;switch(n){case 16:e=t(r.length);break;case 32:e=u(r.length);break;default:throw new Error("invalid array width!")}return e.set(r),e}),a.prototype.lengthen=function(r){for(var n=0,e=this.subarrays;n<e;++n)this[n]=f(this[n],r);this.length=r},a.prototype.add=function(){for(var r,n,e=0,t=this.subarrays;e<t;++e)if(n=(~(r=this.masks[e])&r+1)>>>0,!(32<=(r=this.width-32*e))||n)return r<32&&n&1<<r&&(this[e]=i(this[e],r<<=1),this.width=32*e+r),this.masks[e]|=n,{offset:e,one:n};return this[this.subarrays]=o(this.length),this.masks[this.subarrays]=1,this.width+=8,{offset:this.subarrays++,one:1}},a.prototype.copy=function(r,n){for(var e=0,t=this.subarrays;e<t;++e)this[e][r]=this[e][n]},a.prototype.truncate=function(r){for(var n=0,e=this.subarrays;n<e;++n)for(var t=this.length-1;r<=t;t--)this[n][t]=0;this.length=r},a.prototype.zero=function(r){for(var n=0,e=this.subarrays;n<e;++n)if(this[n][r])return!1;return!0},a.prototype.zeroExcept=function(r,n,e){for(var t=0,o=this.subarrays;t<o;++t)if(t===n?this[t][r]&e:this[t][r])return!1;return!0},a.prototype.zeroExceptMask=function(r,n){for(var e=0,t=this.subarrays;e<t;++e)if(this[e][r]&n[e])return!1;return!0},a.prototype.only=function(r,n,e){for(var t=0,o=this.subarrays;t<o;++t)if(this[t][r]!=(t===n?e:0))return!1;return!0},a.prototype.onlyExcept=function(r,n,e,t,o){for(var u,f=0,i=this.subarrays;f<i;++f)if(u=this[f][r],(u=f===n?(u&e)>>>0:u)!=(f===t?o:0))return!1;return!0};var V={array8:r,array16:r,array32:r,arrayLengthen:n,arrayWiden:e,bitarray:a},w=(e,t)=>function(r){var n=r.length;return[e.left(r,t,0,n),e.right(r,t,0,n)]},E=(e,r)=>{var t=r[0],o=r[1];return function(r){var n=r.length;return[e.left(r,t,0,n),e.left(r,o,0,n)]}},R=r=>[0,r.length],X=r=>r,Y=()=>null,Z=()=>0;function l(i){function r(r,n,e){for(var t=e-n,o=1+(t>>>1);0<--o;)u(r,o,t,n);return r}function u(r,n,e,t){for(var o,u=r[--t+n],f=i(u);(o=n<<1)<=e&&(o<e&&i(r[t+o])>i(r[t+o+1])&&o++,!(f<=i(r[t+o])));)r[t+n]=r[t+o],n=o;r[t+n]=u}return r.sort=function(r,n,e){for(var t,o=e-n;0<--o;)t=r[n],r[n]=r[n+o],r[n+o]=t,u(r,1,o,n);return r},r}const _=l(X);function s(a){var l=_.by(a);return function(r,n,e,t){for(var o,u,f=new Array(t=Math.min(e-n,t)),i=0;i<t;++i)f[i]=r[n++];if(l(f,0,t),n<e)for(o=a(f[0]);a(u=r[n])>o&&(f[0]=u,o=a(l(f,0,t)[0])),++n<e;);return f}}_.by=l;const rr=s(X);function h(u){function r(r,n,e,t){for(;e<t;){var o=e+t>>>1;n<u(r[o])?t=o:e=1+o}return e}return(r.right=r).left=function(r,n,e,t){for(;e<t;){var o=e+t>>>1;u(r[o])<n?e=1+o:t=o}return e},r}rr.by=s;const j=h(X);j.by=h;var nr=(r,n,e)=>{for(var t=0,o=n.length,u=e?JSON.parse(JSON.stringify(r)):new Array(o);t<o;++t)u[t]=r[n[t]];return u},er=r=>r+1,tr=r=>r-1,or=e=>function(r,n){return r+ +e(n)},ur=e=>function(r,n){return r-e(n)};const c=(r,n)=>{const e=r[n];return"function"==typeof e?e.call(r):e},v=/\[([\w\d]+)\]/g;var fr=(r,n)=>function(r,n,e,t,o){for(o in t=(e=e.split(".")).splice(-1,1),e)n=n[e[o]]=n[e[o]]||{};return r(n,t)}(c,r,n.replace(v,".$1")),ir=-1;function p(){var I,r={add:n,remove:function(n){for(var e=new Array(P),t=[],o="function"==typeof n,r=0,u=0;r<P;++r)!function(r){return o?n(K[r],r):I.zero(r)}(r)?e[r]=u++:(t.push(r),e[r]=ir);Q.forEach(function(r){r(-1,-1,[],t,!0)}),T.forEach(function(r){r(e)});for(var f=0,i=0;f<P;++f)e[f]!==ir&&(f!==i&&(I.copy(i,f),K[i]=K[f]),++i);K.length=P=i,I.truncate(i),m("dataRemoved")},dimension:function(z,$){{var n;"string"==typeof z&&(n=z,z=function(r){return fr(r,n)})}var q,B,D,r,G,H,A,k,O,M,C,e,t,F,c={filter:function(r){return null==r?p():(Array.isArray(r)?v:"function"==typeof r?g:l)(r)},filterExact:l,filterRange:v,filterFunction:g,filterAll:p,currentFilter:function(){return e},hasCurrentFilter:function(){return t},top:function(r,n){var e,t=[],o=W,u=0;n&&0<n&&(u=n);for(;--o>=L&&0<r;)I.zero(e=H[o])&&(0<u?--u:(t.push(K[e]),--r));if($)for(o=0;o<N.length&&0<r;o++)I.zero(e=N[o])&&(0<u?--u:(t.push(K[e]),--r));return t},bottom:function(r,n){var e,t,o=[],u=0;n&&0<n&&(u=n);if($)for(e=0;e<N.length&&0<r;e++)I.zero(t=N[e])&&(0<u?--u:(o.push(K[t]),--r));e=L;for(;e<W&&0<r;)I.zero(t=H[e])&&(0<u?--u:(o.push(K[t]),--r)),e++;return o},group:d,groupAll:function(){var r=d(Y),n=r.all;return delete r.all,delete r.top,delete r.order,delete r.orderNatural,delete r.size,r.value=function(){return n()[0].value},r},dispose:x,remove:x,accessor:z,id:function(){return r}},N=[],S=function(r){return lr(r).sort(function(r,n){var e=A[r],t=A[n];return e<t?-1:t<e?1:r-n})},U=R,s=[],h=[],L=0,W=0,J=0;b.unshift(u),b.push(f),T.push(i);var o=I.add();function u(r,n,e){if($){F=[];for(var t=w=J=0;t<r.length;t++)for(w=0,F=z(r[t]);w<F.length;w++)J++;A=[];for(var o=lr(r.length),u=ar(J,1),f=lr(J),i=0,a=0;a<r.length;a++)if((F=z(r[a])).length)for(o[a]=F.length,w=0;w<F.length;w++)A.push(F[w]),f[i]=a,i++;else o[a]=0,N.push(a+n);var l=S(J);A=nr(A,l),k=nr(f,l)}else A=r.map(z),k=S(e),A=nr(A,k);var s,h,c,v=U(A),p=v[0],l=v[1];if($)if(e=J,C)for(s=0;s<e;++s)C(A[s],s)||(0==--o[k[s]]&&(I[D][k[s]+n]|=q),u[s]=1);else{for(h=0;h<p;++h)0==--o[k[h]]&&(I[D][k[h]+n]|=q),u[h]=1;for(c=l;c<e;++c)0==--o[k[c]]&&(I[D][k[c]+n]|=q),u[c]=1}else if(C)for(s=0;s<e;++s)C(A[s],s)||(I[D][k[s]+n]|=q);else{for(h=0;h<p;++h)I[D][k[h]+n]|=q;for(c=l;c<e;++c)I[D][k[c]+n]|=q}if(!n)return G=A,H=k,O=o,M=u,L=p,void(W=l);var g,y=G,d=H,x=M,b=0,t=0;if($&&(g=n,n=y.length,e=J),G=$?new Array(n+e):new Array(P),H=$?new Array(n+e):ar(P,P),$&&(M=ar(n+e,1)),$){var m=O.length;O=V.arrayLengthen(O,P);for(var w=0;w+m<P;w++)O[w+m]=o[w]}for(var E=0;t<n&&b<e;++E)y[t]<A[b]?(G[E]=y[t],$&&(M[E]=x[t]),H[E]=d[t++]):(G[E]=A[b],$&&(M[E]=u[b]),H[E]=k[b++]+($?g:n));for(;t<n;++t,++E)G[E]=y[t],$&&(M[E]=x[t]),H[E]=d[t];for(;b<e;++b,++E)G[E]=A[b],$&&(M[E]=u[b]),H[E]=k[b]+($?g:n);v=U(G),L=v[0],W=v[1]}function f(r,n,e){s.forEach(function(r){r(A,k,n,e)}),A=k=null}function i(r){if($){for(var n=0,e=0;n<N.length;n++)r[N[n]]!==ir&&(N[e]=r[N[n]],e++);for(N.length=e,e=n=0;n<P;n++)r[n]!==ir&&(e!==n&&(O[e]=O[n]),e++);O=O.slice(0,e)}for(var t,o=G.length,u=0,f=0;u<o;++u)r[t=H[u]]!==ir&&(u!==f&&(G[f]=G[u]),H[f]=r[t],$&&(M[f]=M[u]),++f);for(G.length=f,$&&(M=M.slice(0,f));f<o;)H[f++]=0;var i=U(G);L=i[0],W=i[1]}function a(r){var e=r[0],t=r[1];if(C)return C=null,y(function(r,n){return e<=n&&n<t},0===r[0]&&r[1]===G.length),L=e,W=t,c;var n,o,u=[],f=[],i=[],a=[];if(e<L)for(h=e,n=Math.min(L,t);h<n;++h)u.push(H[h]),i.push(h);else if(L<e)for(h=L,n=Math.min(e,W);h<n;++h)f.push(H[h]),a.push(h);if(W<t)for(h=Math.max(e,W),n=t;h<n;++h)u.push(H[h]),i.push(h);else if(t<W)for(h=Math.max(L,t),n=W;h<n;++h)f.push(H[h]),a.push(h);if($){for(var l=[],s=[],h=0;h<u.length;h++)O[u[h]]++,M[i[h]]=0,1===O[u[h]]&&(I[D][u[h]]^=q,l.push(u[h]));for(h=0;h<f.length;h++)O[f[h]]--,M[a[h]]=1,0===O[f[h]]&&(I[D][f[h]]^=q,s.push(f[h]));if(u=l,f=s,U===R)for(h=0;h<N.length;h++)I[D][o=N[h]]&q&&(I[D][o]^=q,u.push(o));else for(h=0;h<N.length;h++)I[D][o=N[h]]&q||(I[D][o]^=q,f.push(o))}else{for(h=0;h<u.length;h++)I[D][u[h]]^=q;for(h=0;h<f.length;h++)I[D][f[h]]^=q}return L=e,W=t,Q.forEach(function(r){r(q,D,u,f)}),m("filtered"),c}function l(r){return e=r,t=!0,a((U=w(j,r))(G))}function v(r){return e=r,t=!0,a((U=E(j,r))(G))}function p(){return e=void 0,t=!1,a((U=R)(G))}function g(r){U=R,y(C=e=r,!(t=!0));r=U(G);return L=r[0],W=r[1],c}function y(r,n){var e,t,o=[],u=[],f=[],i=[],a=G.length;if(!$)for(h=0;h<a;++h)!(I[D][e=H[h]]&q)^!!(t=r(G[h],h))&&(t?o:u).push(e);if($)for(h=0;h<a;++h)r(G[h],h)?(o.push(H[h]),f.push(h)):(u.push(H[h]),i.push(h));if($){for(var l=[],s=[],h=0;h<o.length;h++)1===M[f[h]]&&(O[o[h]]++,M[f[h]]=0,1===O[o[h]]&&(I[D][o[h]]^=q,l.push(o[h])));for(h=0;h<u.length;h++)0===M[i[h]]&&(O[u[h]]--,M[i[h]]=1,0===O[u[h]]&&(I[D][u[h]]^=q,s.push(u[h])));if(o=l,u=s,n)for(h=0;h<N.length;h++)I[D][e=N[h]]&q&&(I[D][e]^=q,o.push(e));else for(h=0;h<N.length;h++)I[D][e=N[h]]&q||(I[D][e]^=q,u.push(e))}else{for(h=0;h<o.length;h++)I[D][o[h]]&q&&(I[D][o[h]]&=B);for(h=0;h<u.length;h++)I[D][u[h]]&q||(I[D][u[h]]|=q)}Q.forEach(function(r){r(q,D,o,u)}),m("filtered")}function d(m){var t={top:function(r){r=e(f(),0,w.length,r);return o.sort(r,0,r.length)},all:f,reduce:i,reduceCount:r,reduceSum:function(r){return i(or(r),ur(r),Z)},order:a,orderNatural:function(){return a(X)},size:function(){return F},dispose:l,remove:l};h.push(t);var w,E,e,o,z,A,k,O,M=8,C=sr(M),F=0,N=Y,S=Y,U=!0,L=m===Y;function n(r,n,e,t){$&&(O=e,e=G.length-r.length,t=r.length);var o,u,f,i,a,l,s=w,h=$?[]:ar(F,C),c=z,v=A,p=k,g=F,y=0,d=0;for(U&&(c=p=Y),U&&(v=p=Y),w=new Array(F),F=0,E=$?g?E:[]:1<g?V.arrayLengthen(E,P):ar(P,C),g&&(f=(u=s[0]).key);d<t&&!((i=m(r[d]))>=i);)++d;for(;d<t;){for(u&&f<=i?(a=u,l=f,h[y]=F,(u=s[++y])&&(f=u.key)):(a={key:i,value:p()},l=i),w[F]=a;i<=l&&(o=n[d]+($?O:e),$?E[o]?E[o].push(F):E[o]=[F]:E[o]=F,a.value=c(a.value,K[o],!0),I.zeroExcept(o,D,B)||(a.value=v(a.value,K[o],!1)),!(++d>=t));)i=m(r[d]);b()}for(;y<g;)w[h[y]=F]=s[y++],b();if($)for(var x=0;x<P;x++)E[x]||(E[x]=[]);if(y<F)if($)for(y=0;y<O;++y)for(x=0;x<E[y].length;x++)E[y][x]=h[E[y][x]];else for(y=0;y<e;++y)E[y]=h[E[y]];function b(){$?F++:++F===C&&(h=V.arrayWiden(h,M<<=1),E=V.arrayWiden(E,M),C=sr(M))}o=Q.indexOf(N),1<F||$?(N=W,S=R):(!F&&L&&(F=1,w=[{key:null,value:p()}]),S=1===F?(N=J,j):N=Y,E=null),Q[o]=N}function u(r){if(1<F||$){var n,e,t,o=F,u=w,f=ar(o,o);if($){for(t=n=0;n<P;++n)if(r[n]!==ir){for(E[t]=E[n],e=0;e<E[t].length;e++)f[E[t][e]]=1;++t}E=E.slice(0,t)}else for(t=n=0;n<P;++n)r[n]!==ir&&(f[E[t]=E[n]]=1,++t);for(w=[],n=F=0;n<o;++n)f[n]&&(f[n]=F++,w.push(u[n]));if(1<F||$)if($)for(n=0;n<t;++n)for(e=0;e<E[n].length;++e)E[n][e]=f[E[n][e]];else for(n=0;n<t;++n)E[n]=f[E[n]];else E=null;Q[Q.indexOf(N)]=1<F||$?(S=R,N=W):1===F?(S=j,N=J):S=N=Y}else if(1===F&&!L){for(var i=0;i<P;++i)if(r[i]!==ir)return;w=[],F=0,Q[Q.indexOf(N)]=N=S=Y}}function W(r,n,e,t,o){var u,f,i,a,l;if(!(r===q&&n===D||U))if($){for(u=0,a=e.length;u<a;++u)if(I.zeroExcept(i=e[u],D,B))for(f=0;f<E[i].length;f++)(l=w[E[i][f]]).value=z(l.value,K[i],!1,f);for(u=0,a=t.length;u<a;++u)if(I.onlyExcept(i=t[u],D,B,n,r))for(f=0;f<E[i].length;f++)(l=w[E[i][f]]).value=A(l.value,K[i],o,f)}else{for(u=0,a=e.length;u<a;++u)I.zeroExcept(i=e[u],D,B)&&((l=w[E[i]]).value=z(l.value,K[i],!1));for(u=0,a=t.length;u<a;++u)I.onlyExcept(i=t[u],D,B,n,r)&&((l=w[E[i]]).value=A(l.value,K[i],o))}}function J(r,n,e,t,o){if(!(r===q&&n===D||U)){for(var u,f=w[0],i=0,a=e.length;i<a;++i)I.zeroExcept(u=e[i],D,B)&&(f.value=z(f.value,K[u],!1));for(i=0,a=t.length;i<a;++i)I.onlyExcept(u=t[i],D,B,n,r)&&(f.value=A(f.value,K[u],o))}}function R(){for(var r,n,e=0;e<F;++e)w[e].value=k();if($){for(e=0;e<P;++e)for(r=0;r<E[e].length;r++)(n=w[E[e][r]]).value=z(n.value,K[e],!0,r);for(e=0;e<P;++e)if(!I.zeroExcept(e,D,B))for(r=0;r<E[e].length;r++)(n=w[E[e][r]]).value=A(n.value,K[e],!1,r)}else{for(e=0;e<P;++e)(n=w[E[e]]).value=z(n.value,K[e],!0);for(e=0;e<P;++e)I.zeroExcept(e,D,B)||((n=w[E[e]]).value=A(n.value,K[e],!1))}}function j(){var r,n=w[0];for(n.value=k(),r=0;r<P;++r)n.value=z(n.value,K[r],!0);for(r=0;r<P;++r)I.zeroExcept(r,D,B)||(n.value=A(n.value,K[r],!1))}function f(){return U&&(S(),U=!1),w}function i(r,n,e){return z=r,A=n,k=e,U=!0,t}function r(){return i(er,tr,Z)}function a(n){function r(r){return n(r.value)}return e=rr.by(r),o=_.by(r),t}function l(){var r=Q.indexOf(N);return 0<=r&&Q.splice(r,1),0<=(r=s.indexOf(n))&&s.splice(r,1),0<=(r=T.indexOf(u))&&T.splice(r,1),0<=(r=h.indexOf(t))&&h.splice(r,1),t}return arguments.length<1&&(m=X),Q.push(N),s.push(n),T.push(u),n(G,H,0,P),r().orderNatural()}function x(){h.forEach(function(r){r.dispose()});var r=b.indexOf(u);return 0<=r&&b.splice(r,1),0<=(r=b.indexOf(f))&&b.splice(r,1),0<=(r=T.indexOf(i))&&T.splice(r,1),I.masks[D]&=B,p()}return D=o.offset,q=o.one,B=~q,r=D<<7|Math.log(q)/Math.log(2),u(K,0,P),f(0,0,P),c},groupAll:function(){var a,l,s,t,o={reduce:u,reduceCount:r,reduceSum:function(r){return u(or(r),ur(r),Z)},value:function(){h&&(function(){var r;for(a=t(),r=0;r<P;++r)a=l(a,K[r],!0),I.zero(r)||(a=s(a,K[r],!1))}(),h=!1);return a},dispose:f,remove:f},h=!0;function n(r,n){var e;if(!h)for(e=n;e<P;++e)a=l(a,K[e],!0),I.zero(e)||(a=s(a,K[e],!1))}function e(r,n,e,t,o){var u,f,i;if(!h){for(u=0,i=e.length;u<i;++u)I.zero(f=e[u])&&(a=l(a,K[f],o));for(u=0,i=t.length;u<i;++u)I.only(f=t[u],n,r)&&(a=s(a,K[f],o))}}function u(r,n,e){return l=r,s=n,t=e,h=!0,o}function r(){return u(er,tr,Z)}function f(){var r=Q.indexOf(e);return 0<=r&&Q.splice(r,1),0<=(r=b.indexOf(n))&&b.splice(r,1),o}return Q.push(e),b.push(n),n(0,0),r()},size:function(){return P},all:function(){return K},allFiltered:function(r){var n=[],e=0,t=o(r||[]);for(e=0;e<P;e++)I.zeroExceptMask(e,t)&&n.push(K[e]);return n},onChange:function(r){if("function"==typeof r)return e.push(r),function(){e.splice(e.indexOf(r),1)};console.warn("onChange callback parameter must be a function!")},isElementFiltered:function(r,n){n=o(n||[]);return I.zeroExceptMask(r,n)}},K=[],P=0,Q=[],b=[],T=[],e=[];function n(n){var e=P,t=n.length;return t&&(K=K.concat(n),I.lengthen(P+=t),b.forEach(function(r){r(n,e,t)}),m("dataAdded")),r}function o(r){for(var n,e,t,o=Array(I.subarrays),u=0;u<I.subarrays;u++)o[u]=-1;for(n=0,e=r.length;n<e;n++)o[(t=r[n].id())>>7]&=~(1<<(63&t));return o}function m(r){for(var n=0;n<e.length;n++)e[n](r)}return I=new V.bitarray(0),arguments.length?n(arguments[0]):r}function ar(r,n){return(n<257?V.array8:n<65537?V.array16:V.array32)(r)}function lr(r){for(var n=ar(r,r),e=-1;++e<r;)n[e]=e;return n}function sr(r){return 8===r?256:16===r?65536:4294967296}p.heap=_,p.heapselect=rr,p.bisect=j,p.permute=nr;return p.version="1.5.4",p});